import{d as e,h as a,u as t,q as l,v as s,m as c,r as n,i as r,a as o,w as i,A as d,c as u,y as v,p,j as m,k as f,o as j,T as I,F as y,B as g,E as P,l as w,x,G as W,t as b,C as h,H as _,I as S,J as k,g as C}from"./vendor.6e217547.js";import{V as J,_ as N,C as O}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.591f3c91.js";import{g as V,E as q,A as U}from"./uuid.4ba239b0.js";const L=e=>{const a=localStorage.getItem("PWList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},B=e=>{const a=localStorage.getItem("PWList");if(a){const t=JSON.parse(a).filter((a=>a.projectId===e));if(t)return Promise.resolve(t)}return Promise.resolve([])},D=async e=>{if(e.id&&e.projectId){const a=await B(e.projectId),t=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===t?a.push(e):a[t]=e;const l=L(e.projectId);return localStorage.setItem("PWList",JSON.stringify(l.concat(a))),Promise.resolve()}return Promise.reject()};p("data-v-0fc96a6d");const E={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},M=m("div",{class:"mt-4"},"表单管理",-1),T=["onClick"],A=w(" 新建表单 ");f();var H=e({emits:["updateSelectedPW"],setup(e,{emit:p}){const m=a([]),f=t(),W=l(),b=s(),h=a(!1),_=a({id:"",name:"",projectId:""}),S=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],k=async e=>{h.value=!1,"edit"===e&&await D(_.value),await z()},C=async()=>{const e={id:V(),projectId:W.query.id+"",name:"第"+(m.value.length+1)+"场"};try{await D(e),f.success("保存成功"),await z()}catch(a){f.error("保存失败")}},O=async()=>{try{await(async(e,a)=>{const t=L(a);return localStorage.setItem("PWList",JSON.stringify(t.concat(e))),Promise.resolve()})(m.value,W.query.id+""),await z()}catch(e){f.error("调整顺序失败")}},H=e=>{_.value=e,p("updateSelectedPW",e)},F=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await B(e.projectId),t=a.findIndex((a=>e.id===a.id));if(t>-1){a.splice(t,1);const l=L(e.projectId);return localStorage.setItem("PWList",JSON.stringify(l.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),f.success("删除成功"),await z()}catch(a){f.error("删除失败")}},G=async e=>{"edit"===e&&(h.value=!0),"delete"===e&&b.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{F(_.value)}})},z=async()=>{try{m.value=await B(W.query.id+""),m.value.length>0&&H(m.value[0])}catch(e){f.error("获取分镜头列表失败")}};return c((()=>{z()})),(e,a)=>{const t=n("n-icon"),l=n("n-dropdown"),s=n("n-button");return j(),r("div",E,[M,o(d(J),{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),onChange:O},{default:i((()=>[o(I,null,{default:i((()=>[(j(!0),r(y,null,g(m.value,((e,a)=>(j(),r("div",{class:P(["PW-aside-item",e.id===_.value.id?"active":""]),key:a,onClick:a=>H(e)},[w(x(e.name||"新建表单"+(a+1))+" ",1),o(l,{trigger:"click",onSelect:G,options:S,"show-arrow":!0},{default:i((()=>[o(t,{class:"PW-aside-item-icon"},{default:i((()=>[o(d(q))])),_:1})])),_:1})],10,T)))),128))])),_:1})])),_:1},8,["modelValue"]),o(s,{class:"mt-4 w-56",onClick:C},{icon:i((()=>[o(t,null,{default:i((()=>[o(d(U))])),_:1})])),default:i((()=>[A])),_:1}),h.value?(j(),u(N,{key:0,showModal:h.value,inputVal:_.value.name,"onUpdate:inputVal":a[1]||(a[1]=e=>_.value.name=e),placeholder:"请输入新的名字",onCancelClick:a[2]||(a[2]=e=>k("cancel")),onConfirmClick:a[3]||(a[3]=e=>k("edit"))},null,8,["showModal","inputVal"])):v("v-if",!0)])}}});H.__scopeId="data-v-0fc96a6d";const F=[{label:"外景",value:"外景"},{label:"内景",value:"内景"},{label:"外景+内景",value:"外景+内景"}],G=[{label:"日景",value:"日景"},{label:"夜景",value:"夜景"}],z={class:"p-10 pt-5 flex-auto w-full"},K={class:"text-3xl pb-5"},Q={class:""},R=S('<div class="flex items-center bg-gray-100 h-10 text-gray-500 text-sm"><div class="w-40 pl-4">场景类型</div><div class="w-40 pl-2">场景时间</div><div class="w-40 pl-2">场景陈设</div><div class="flex-auto ml-4 pl-2.5">场景简述</div></div>',1),X={class:"flex items-center h-10 text-gray-500 text-sm mt-2.5"},Y={class:"w-40 pl-4"},Z={class:"flex items-center cursor-pointer"},$={class:"w-40 pl-2"},ee={class:"flex items-center cursor-pointer"};var ae=e({props:{PWId:{type:String,required:!0},name:{type:String,required:!0}},setup(e){const l=e,s=t(),c=a({id:"",name:"",PWId:"",cj:{cjlx:"",cjsj:"",cjcs:"",cjjs:""},dj:[]});W((()=>l.PWId),(()=>{u()})),b((()=>{k((()=>{u()}))}));const u=async()=>{c.value=await(e=>{const a=localStorage.getItem("PWDetailInfo");let t;a&&(t=JSON.parse(a).find((a=>e===a.PWId)));return t||(t={id:"",name:"",PWId:"",cj:{cjlx:"",cjsj:"",cjcs:"",cjjs:""},dj:[]}),Promise.resolve(t)})(l.PWId)},v=async()=>{c.value.id||(c.value.id=V()),c.value.PWId||(c.value.PWId=l.PWId);try{await(async e=>{const a=localStorage.getItem("PWDetailInfo")||JSON.stringify([]),t=JSON.parse(a),l=t.findIndex((a=>e.PWId===a.PWId));return l>-1?t[l]=e:t.push(e),localStorage.setItem("PWDetailInfo",JSON.stringify(t)),Promise.resolve()})(c.value)}catch(e){s.error("保存失败")}};return(e,a)=>{const t=n("n-divider"),s=n("n-icon"),u=n("n-popselect");return j(),r("div",z,[m("div",K,x(l.name),1),o(t),m("div",Q,[R,m("div",X,[m("div",Y,[o(u,{options:d(F),value:c.value.cj.cjlx,"onUpdate:value":[a[0]||(a[0]=e=>c.value.cj.cjlx=e),v],trigger:"click",scrollable:""},{default:i((()=>[m("div",Z,[w(x(c.value.cj.cjlx||"类型")+" ",1),o(s,null,{default:i((()=>[o(d(O))])),_:1})])])),_:1},8,["options","value"])]),m("div",$,[o(u,{options:d(G),value:c.value.cj.cjsj,"onUpdate:value":[a[1]||(a[1]=e=>c.value.cj.cjsj=e),v],trigger:"click",scrollable:""},{default:i((()=>[m("div",ee,[w(x(c.value.cj.cjsj||"时间")+" ",1),o(s,null,{default:i((()=>[o(d(O))])),_:1})])])),_:1},8,["options","value"])]),h(m("input",{class:"input w-40","onUpdate:modelValue":a[2]||(a[2]=e=>c.value.cj.cjcs=e),type:"text",onBlur:v,placeholder:"请输入内容描述"},null,544),[[_,c.value.cj.cjcs]]),h(m("input",{class:"input ml-4 flex-auto","onUpdate:modelValue":a[3]||(a[3]=e=>c.value.cj.cjjs=e),type:"text",onBlur:v,placeholder:"请输入内容描述"},null,544),[[_,c.value.cj.cjjs]])])]),o(t)])}}});p("data-v-56d7a5ca");const te={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},le=w(" 所有项目 "),se=w(" 项目统筹 "),ce=w("打印预览"),ne=w("分享"),re={class:"sl-content flex"};f();var oe=e({setup(e){const t=l(),s=C(),c=a(!1),r=a({id:"",name:"",PWId:""}),v=e=>{r.value=e},p=()=>{s.push({name:"ProjectHome"})},f=()=>{s.go(-1)};return(e,a)=>{const l=n("n-breadcrumb-item"),s=n("n-breadcrumb"),I=n("n-button"),y=n("n-space"),g=n("n-spin");return j(),u(g,{show:c.value},{default:i((()=>[m("div",te,[o(s,null,{default:i((()=>[o(l,{onClick:p},{default:i((()=>[le])),_:1}),o(l,{onClick:f},{default:i((()=>[w(x(d(t).query.name),1)])),_:1}),o(l,null,{default:i((()=>[se])),_:1})])),_:1}),o(y,null,{default:i((()=>[o(I,null,{default:i((()=>[ce])),_:1}),o(I,null,{default:i((()=>[ne])),_:1})])),_:1})]),m("div",re,[o(H,{onUpdateSelectedPW:v}),o(ae,{PWId:r.value.id,name:r.value.name},null,8,["PWId","name"])])])),_:1},8,["show"])}}});oe.__scopeId="data-v-56d7a5ca";export{oe as default};
