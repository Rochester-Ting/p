import{d as e,j as a,h as l,t,y as s,s as o,r as n,k as r,b as u,w as i,u as d,c,B as p,p as v,l as m,m as f,o as h,T as y,G as b,D as w,H as g,q as j,A as x,x as I,I as S,E as _,J as k,K as U,L as V,i as P}from"./vendor.882c7a74.js";import{V as C,_ as J,C as N}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.44a8a774.js";import{g as O}from"./uuid.a7ba8b83.js";import{E as L,A as D}from"./EllipsisHorizontalSharp.17c10d59.js";const q=e=>{const a=localStorage.getItem("shootList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},z=e=>{const a=localStorage.getItem("shootList");if(a){const l=JSON.parse(a).filter((a=>a.projectId===e));if(l)return Promise.resolve(l)}return Promise.resolve([])},B=async e=>{if(e.id&&e.projectId){const a=await z(e.projectId),l=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===l?a.push(e):a[l]=e;const t=q(e.projectId);return localStorage.setItem("shootList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()};v("data-v-052684fc");const E={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},T=m("div",{class:"mt-4"},"分镜头列表",-1),H=["onClick"],M=j(" 新建分镜头 ");f();var A=e({emits:["updateSelectedSL"],setup(e,{emit:v}){const m=a([]),f=l(),I=t(),S=s(),_=a(!1),k=a({id:"",name:"",projectId:""}),U=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],V=async e=>{_.value=!1,"edit"===e&&await B(k.value),await F()},P=async()=>{const e={id:O(),projectId:I.query.id+"",name:"第"+(m.value.length+1)+"场"};try{await B(e),f.success("保存成功"),await F()}catch(a){f.error("保存失败")}},N=async()=>{try{await(async(e,a)=>{const l=q(a);return localStorage.setItem("shootList",JSON.stringify(l.concat(e))),Promise.resolve()})(m.value,I.query.id+""),await F()}catch(e){f.error("调整顺序失败")}},A=e=>{k.value=e,v("updateSelectedSL",e)},G=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await z(e.projectId),l=a.findIndex((a=>e.id===a.id));if(l>-1){a.splice(l,1);const t=q(e.projectId);return localStorage.setItem("shootList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),f.success("删除成功"),await F()}catch(a){f.error("删除失败")}},K=async e=>{"edit"===e&&(_.value=!0),"delete"===e&&S.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{G(k.value)}})},F=async()=>{try{m.value=await z(I.query.id+""),m.value.length>0&&A(m.value[0])}catch(e){f.error("获取分镜头列表失败")}};return o((()=>{F()})),(e,a)=>{const l=n("n-icon"),t=n("n-dropdown"),s=n("n-button");return h(),r("div",E,[T,u(d(C),{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),onChange:N},{default:i((()=>[u(y,null,{default:i((()=>[(h(!0),r(b,null,w(m.value,((e,a)=>(h(),r("div",{class:g(["sl-aside-item",e.id===k.value.id?"active":""]),key:a,onClick:a=>A(e)},[j(x(e.name||"新建分镜头"+(a+1))+" ",1),u(t,{trigger:"click",onSelect:K,options:U,"show-arrow":!0},{default:i((()=>[u(l,{class:"sl-aside-item-icon"},{default:i((()=>[u(d(L))])),_:1})])),_:1})],10,H)))),128))])),_:1})])),_:1},8,["modelValue"]),u(s,{class:"mt-4 w-56",onClick:P},{icon:i((()=>[u(l,null,{default:i((()=>[u(d(D))])),_:1})])),default:i((()=>[M])),_:1}),_.value?(h(),c(J,{key:0,showModal:_.value,inputVal:k.value.name,"onUpdate:inputVal":a[1]||(a[1]=e=>k.value.name=e),placeholder:"请输入新的名字",onCancelClick:a[2]||(a[2]=e=>V("cancel")),onConfirmClick:a[3]||(a[3]=e=>V("edit"))},null,8,["showModal","inputVal"])):p("v-if",!0)])}}});A.__scopeId="data-v-052684fc";const G=e=>{const a=localStorage.getItem("shootDetail");if(a){const l=JSON.parse(a);return Promise.resolve(l.filter((a=>e===a.shootId))||[])}return Promise.resolve([])},K=e=>{const a=localStorage.getItem("shootDetail")||JSON.stringify([]);return JSON.parse(a).filter((a=>e!==a.shootId))},F=[{label:"超远景",value:"超远景"},{label:"远景",value:"远景"},{label:"全景",value:"全景"},{label:"中景",value:"中景"},{label:"近景",value:"近景"},{label:"特写",value:"特写"},{label:"大特写",value:"大特写"},{label:"自定义",value:"自定义"}],Q=[{label:"固定",value:"固定"},{label:"推动",value:"推动"},{label:"拉动",value:"拉动"},{label:"摇动",value:"摇动"},{label:"甩动",value:"甩动"},{label:"移动",value:"移动"},{label:"跟拍",value:"跟拍"},{label:"上升",value:"上升"},{label:"下降",value:"下降"}],R=[{label:"低角度",value:"低角度"},{label:"高角度",value:"高角度"},{label:"俯视角度",value:"俯视角度"},{label:"视线高度",value:"视线高度"},{label:"地面高度",value:"地面高度"}];v("data-v-7e9fd0bd");const W={class:"p-10 pt-5 flex-auto w-full"},X={class:"text-3xl pb-5"},Y=U('<div class="flex items-center h-10 bg-gray-50 text-gray-500 text-sm" data-v-7e9fd0bd><span class="w-20 pl-2" data-v-7e9fd0bd>场次</span><span class="w-20 pl-2" data-v-7e9fd0bd>镜号</span><span class="flex-auto pl-2" data-v-7e9fd0bd>内容描述</span><span class="w-32 pl-4" data-v-7e9fd0bd>景别</span><span class="w-32 pl-4" data-v-7e9fd0bd>镜头类型</span><span class="w-40 pl-4" data-v-7e9fd0bd>机位运动</span><span class="w-40 pl-2" data-v-7e9fd0bd>备注</span><span class="w-32 pl-4" data-v-7e9fd0bd>操作</span></div>',1),Z=["value"],$=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],ae={class:"w-32 pl-4"},le={class:"flex items-center cursor-pointer"},te={class:"w-32 pl-4"},se={class:"flex items-center cursor-pointer"},oe={class:"w-40 pl-4"},ne={class:"flex items-center cursor-pointer"},re=["onUpdate:modelValue"],ue=["onClick"],ie={class:"flex items-center h-10 text-gray-500 text-sm text-gray-500"},de=["value"],ce={class:"w-32 pl-4"},pe={class:"flex items-center cursor-pointer"},ve={class:"w-32 pl-4"},me={class:"flex items-center cursor-pointer"},fe={class:"w-40 pl-4"},he={class:"flex items-center cursor-pointer"};f();var ye=e({props:{name:{type:String,required:!0},shootId:{type:String,required:!0}},setup(e){const t=e,s=a(!1),o=l(),c=a([]),p=a({id:"",shootId:"",cc:"",jh:"",nrms:"",jb:"",jwyd:"",bz:"",jtlx:""});I((()=>{V((()=>{f(t.shootId)}))})),S((()=>t.shootId),(()=>{f(t.shootId)}));const v=async()=>{try{await(async e=>{const a=K(e[0].shootId).concat(e);return localStorage.setItem("shootDetail",JSON.stringify(a)),Promise.resolve()})(c.value),await G(t.shootId)}catch(e){o.error("保存失败")}},f=async e=>{s.value=!0,c.value=await G(e),setTimeout((()=>{s.value=!1}),800)},g=async()=>{try{if(p.value.id=O(),p.value.shootId=t.shootId,!(p.value.id&&p.value.shootId&&p.value.jh&&p.value.nrms&&p.value.jb&&p.value.jwyd))return void o.error("请填写完整分镜头");await(async e=>{const a=localStorage.getItem("shootDetail")||JSON.stringify([]),l=JSON.parse(a);return l.push(e),localStorage.setItem("shootDetail",JSON.stringify(l)),Promise.resolve()})(p.value),p.value={id:"",shootId:"",cc:"",jh:"",nrms:"",jb:"",jwyd:"",bz:"",jtlx:""},await f(t.shootId)}catch(e){o.error("保存失败")}},U=async e=>{try{await(async e=>{const a=localStorage.getItem("shootDetail")||JSON.stringify([]),l=JSON.parse(a),t=l.findIndex((a=>a.id===e.id));return-1===t?Promise.reject():(l.splice(t,1),localStorage.setItem("shootDetail",JSON.stringify(l)),Promise.resolve())})(e),o.success("删除成功"),await f(t.shootId)}catch(a){o.error("删除失败")}},P=()=>{v()};return(e,a)=>{const l=n("n-icon"),s=n("n-popselect");return h(),r("div",W,[m("div",X,x(t.name),1),m("div",null,[Y,u(d(C),{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),onChange:P},{default:i((()=>[u(y,null,{default:i((()=>[(h(!0),r(b,null,w(c.value,((e,a)=>(h(),r("div",{class:"\n              flex\n              items-center\n              w-full\n              h-10\n              text-gray-500 text-sm text-gray-500\n            ",key:a},[m("input",{class:"input w-20 h-10",value:t.name,type:"text",disabled:!0,onBlur:v,placeholder:"场次"},null,40,Z),_(m("input",{class:"input w-20 h-10","onUpdate:modelValue":a=>e.jh=a,type:"text",onBlur:v,placeholder:"镜号"},null,40,$),[[k,e.jh]]),_(m("input",{class:"input flex-auto","onUpdate:modelValue":a=>e.nrms=a,type:"text",onBlur:v,placeholder:"请输入内容描述"},null,40,ee),[[k,e.nrms]]),m("div",ae,[u(s,{options:d(F),value:e.jb,"onUpdate:value":[a=>e.jb=a,v],trigger:"click",scrollable:""},{default:i((()=>[m("div",le,[j(x(e.jb||"景别")+" ",1),u(l,null,{default:i((()=>[u(d(N))])),_:1})])])),_:2},1032,["options","value","onUpdate:value"])]),m("div",te,[u(s,{options:d(R),value:e.jtlx,"onUpdate:value":[a=>e.jtlx=a,v],trigger:"click",scrollable:""},{default:i((()=>[m("div",se,[j(x(e.jtlx||"镜头类型")+" ",1),u(l,null,{default:i((()=>[u(d(N))])),_:1})])])),_:2},1032,["options","value","onUpdate:value"])]),m("div",oe,[u(s,{options:d(Q),value:e.jwyd,"onUpdate:value":[a=>e.jwyd=a,v],trigger:"click",scrollable:""},{default:i((()=>[m("div",ne,[j(x(e.jwyd||"机位运动")+" ",1),u(l,null,{default:i((()=>[u(d(N))])),_:1})])])),_:2},1032,["options","value","onUpdate:value"])]),_(m("input",{class:"input w-40","onUpdate:modelValue":a=>e.bz=a,type:"text",onBlur:v,placeholder:"请输入内容描述"},null,40,re),[[k,e.bz]]),m("span",{class:"w-32 pl-4 cursor-pointer underline text-red-700",onClick:a=>U(e)}," 删除 ",8,ue)])))),128))])),_:1})])),_:1},8,["modelValue"]),m("div",ie,[m("input",{class:"input w-20 h-10",disabled:!0,value:t.name,type:"text",placeholder:"场次"},null,8,de),_(m("input",{class:"input w-20 h-10","onUpdate:modelValue":a[1]||(a[1]=e=>p.value.jh=e),type:"text",placeholder:"镜号"},null,512),[[k,p.value.jh]]),_(m("input",{class:"input flex-auto","onUpdate:modelValue":a[2]||(a[2]=e=>p.value.nrms=e),type:"text",placeholder:"请输入内容描述"},null,512),[[k,p.value.nrms]]),m("div",ce,[u(s,{options:d(F),value:p.value.jb,"onUpdate:value":a[3]||(a[3]=e=>p.value.jb=e),trigger:"click",scrollable:""},{default:i((()=>[m("div",pe,[j(x(p.value.jb||"景别")+" ",1),u(l,null,{default:i((()=>[u(d(N))])),_:1})])])),_:1},8,["options","value"])]),m("div",ve,[u(s,{options:d(R),value:p.value.jtlx,"onUpdate:value":a[4]||(a[4]=e=>p.value.jtlx=e),trigger:"click",scrollable:""},{default:i((()=>[m("div",me,[j(x(p.value.jtlx||"镜头类型")+" ",1),u(l,null,{default:i((()=>[u(d(N))])),_:1})])])),_:1},8,["options","value"])]),m("div",fe,[u(s,{options:d(Q),value:p.value.jwyd,"onUpdate:value":a[5]||(a[5]=e=>p.value.jwyd=e),trigger:"click",scrollable:""},{default:i((()=>[m("div",he,[j(x(p.value.jwyd||"机位运动")+" ",1),u(l,null,{default:i((()=>[u(d(N))])),_:1})])])),_:1},8,["options","value"])]),_(m("input",{class:"input w-40","onUpdate:modelValue":a[6]||(a[6]=e=>p.value.bz=e),type:"text",placeholder:"请输入内容描述"},null,512),[[k,p.value.bz]]),m("div",{class:"w-32 pl-4 cursor-pointer underline text-green-700",onClick:g}," 添加 ")])])])}}});ye.__scopeId="data-v-7e9fd0bd",v("data-v-2524e697");const be={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},we=j(" 所有项目 "),ge=j(" 分镜头列表 "),je=j("打印预览"),xe=j("分享"),Ie={class:"sl-content flex"};f();var Se=e({setup(e){const l=t(),s=P(),o=a(!1),r=a({id:"",name:"",projectId:""}),v=e=>{r.value=e},f=()=>{s.push({name:"ProjectHome"})},y=()=>{s.go(-1)};return(e,a)=>{const t=n("n-breadcrumb-item"),s=n("n-breadcrumb"),b=n("n-button"),w=n("n-space"),g=n("n-spin");return h(),c(g,{show:o.value},{default:i((()=>[m("div",be,[u(s,null,{default:i((()=>[u(t,{onClick:f},{default:i((()=>[we])),_:1}),u(t,{onClick:y},{default:i((()=>[j(x(d(l).query.name),1)])),_:1}),u(t,null,{default:i((()=>[ge])),_:1})])),_:1}),u(w,null,{default:i((()=>[u(b,{type:"primary"},{default:i((()=>[je])),_:1}),u(b,{type:"primary"},{default:i((()=>[xe])),_:1})])),_:1})]),m("div",Ie,[u(A,{onUpdateSelectedSL:v}),r.value.id?(h(),c(ye,{key:0,shootId:r.value.id,name:r.value.name},null,8,["shootId","name"])):p("v-if",!0)])])),_:1},8,["show"])}}});Se.__scopeId="data-v-2524e697";export{Se as default};
