import{d as e,o as a,c as t,b as l,j as n,h as s,t as r,y as o,s as i,r as d,k as c,w as u,u as p,B as m,p as v,l as w,m as y,T as f,G as h,D as g,H as x,q as k,A as b,C as j,I as _,O as U,E as C,J as I,K as V,i as z}from"./vendor.882c7a74.js";import{V as S,E as P,A as B}from"./vue-draggable-next.esm-bundler.776c20e5.js";import{_ as N,C as O}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.05f4e946.js";import{g as T}from"./uuid.a7ba8b83.js";const J={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},G=l("path",{d:"M256 48c-79.5 0-144 61.39-144 137c0 87 96 224.87 131.25 272.49a15.77 15.77 0 0 0 25.5 0C304 409.89 400 272.07 400 185c0-75.61-64.5-137-144-137z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),M=l("circle",{cx:"256",cy:"192",r:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1);var q=e({name:"LocationOutline",render:function(e,l){return a(),t("svg",J,[G,M])}});const L={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},A=l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 232v-80"},null,-1),E=l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 88V72"},null,-1),H=l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M132 132l-12-12"},null,-1),W=l("circle",{cx:"256",cy:"272",r:"32",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),D=l("path",{d:"M256 96a176 176 0 1 0 176 176A176 176 0 0 0 256 96z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1);var K=e({name:"StopwatchOutline",render:function(e,l){return a(),t("svg",L,[A,E,H,W,D])}});const F=e=>{const a=localStorage.getItem("TGList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},Q=e=>{const a=localStorage.getItem("TGList");if(a){const t=JSON.parse(a).filter((a=>a.projectId===e));if(t)return Promise.resolve(t)}return Promise.resolve([])},R=async e=>{if(e.id&&e.projectId){const a=await Q(e.projectId),t=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===t?a.push(e):a[t]=e;const l=F(e.projectId);return localStorage.setItem("TGList",JSON.stringify(l.concat(a))),Promise.resolve()}return Promise.reject()};v("data-v-5868a466");const X={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},Y=w("div",{class:"mt-4"},"通告管理",-1),Z=["onClick"],$=k(" 新建通告 ");y();var ee=e({emits:["updateSelectedTG","hidden"],setup(e,{emit:v}){const w=n([]),y=s(),j=r(),_=o(),U=n(!1),C=n({id:"",name:"",projectId:""}),I=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],V=async e=>{U.value=!1,"edit"===e&&await R(C.value),await q()},z=async()=>{const e={id:T(),projectId:j.query.id+"",name:"通告"+(w.value.length+1)+"("+T().substr(Math.floor(10*Math.random()+1),2)+")"};try{await R(e),y.success("保存成功"),await q()}catch(a){y.error("保存失败")}},O=async()=>{try{await(async(e,a)=>{const t=F(a);return localStorage.setItem("TGList",JSON.stringify(t.concat(e))),Promise.resolve()})(w.value,j.query.id+""),await q()}catch(e){y.error("调整顺序失败")}},J=e=>{C.value=e,v("updateSelectedTG",e)},G=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await Q(e.projectId),t=a.findIndex((a=>e.id===a.id));if(t>-1){a.splice(t,1);const l=F(e.projectId);return localStorage.setItem("TGList",JSON.stringify(l.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),y.success("删除成功"),await q()}catch(a){y.error("删除失败")}},M=async e=>{"edit"===e&&(U.value=!0),"delete"===e&&_.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{G(C.value)}})},q=async()=>{try{w.value=await Q(j.query.id+""),w.value.length>0?(J(w.value[0]),v("hidden",!0)):v("hidden",!1)}catch(e){y.error("获取分镜头列表失败")}};return i((()=>{q()})),(e,n)=>{const s=d("n-icon"),r=d("n-dropdown"),o=d("n-button");return a(),c("div",X,[Y,l(p(S),{modelValue:w.value,"onUpdate:modelValue":n[0]||(n[0]=e=>w.value=e),onChange:O},{default:u((()=>[l(f,null,{default:u((()=>[(a(!0),c(h,null,g(w.value,((e,t)=>(a(),c("div",{class:x(["TG-aside-item",e.id===C.value.id?"active":""]),key:t,onClick:a=>J(e)},[k(b(e.name||"新建通告"+(t+1))+" ",1),l(r,{trigger:"click",onSelect:M,options:I,"show-arrow":!0},{default:u((()=>[l(s,{class:"TG-aside-item-icon"},{default:u((()=>[l(p(P))])),_:1})])),_:1})],10,Z)))),128))])),_:1})])),_:1},8,["modelValue"]),l(o,{class:"mt-4 w-56",onClick:z},{icon:u((()=>[l(s,null,{default:u((()=>[l(p(B))])),_:1})])),default:u((()=>[$])),_:1}),U.value?(a(),t(N,{key:0,showModal:U.value,inputVal:C.value.name,"onUpdate:inputVal":n[1]||(n[1]=e=>C.value.name=e),placeholder:"请输入新的名字",onCancelClick:n[2]||(n[2]=e=>V("cancel")),onConfirmClick:n[3]||(n[3]=e=>V("edit"))},null,8,["showModal","inputVal"])):m("v-if",!0)])}}});ee.__scopeId="data-v-5868a466";v("data-v-389e094e");const ae={class:"m-10 mt-5 flex-auto w-full overflow-y-auto overflow-x-hidden"},te={class:"\n        bg-gray-100\n        flex flex-col\n        items-center\n        pb-10\n        overflow-y-auto overflow-x-hidden\n      "},le={class:"flex items-center text-3xl mt-10"},ne=k(" 通告单通过 Wonder Wrap 制作 "),se={class:"mt-5 text-gray-500 text-gray-500 text-sm mb-2 flex items-center"},re=k("拍摄时间 "),oe={class:"mt-5 text-gray-500 text-sm mb-2 flex items-center"},ie=k(" 拍摄地址 "),de=k(" 拍摄顺序 "),ce={class:"w-custom"},ue=V('<div class="\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          " data-v-389e094e><span class="w-20" data-v-389e094e>场次</span><span class="w-28" data-v-389e094e> 内景/外景 </span><span class="w-28" data-v-389e094e> 日景/夜景 </span><span class="flex-auto" data-v-389e094e>内容简述</span><span class="w-20" data-v-389e094e>备注</span><span class="w-20" data-v-389e094e>预估耗时(/h)</span><span class="w-14" data-v-389e094e>操作</span></div>',1),pe={class:"w-20"},me={class:"w-28 cursor-pointer"},ve={class:"w-28 cursor-pointer"},we=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],fe=["onUpdate:modelValue"],he=w("span",{class:"w-14 cursor-pointer underline text-red-700"}," 删除 ",-1),ge=k(" 是否删除 "),xe={class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          "},ke=V('<span class="w-20" data-v-389e094e>总计</span><span class="w-28 cursor-pointer" data-v-389e094e></span><span class="w-28 cursor-pointer" data-v-389e094e></span><span class="flex-auto" data-v-389e094e></span><span class="w-20" data-v-389e094e></span>',5),be={class:"w-20"},je=w("span",{class:"w-14"},null,-1),_e={class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          "},Ue={class:"w-28 cursor-pointer"},Ce={style:{width:"100px"},class:"w-28 cursor-pointer"},Ie=k(" 演职人员 "),Ve={class:"w-custom"},ze=V('<div class="\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          " data-v-389e094e><span class="w-20" data-v-389e094e>姓名</span><span class="w-28" data-v-389e094e> 职务 </span><span class="w-28" data-v-389e094e> 到场时间 </span><span class="flex-auto" data-v-389e094e>备注</span><span class="w-20" data-v-389e094e>操作</span></div>',1),Se=["onUpdate:modelValue"],Pe=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Ne=w("span",{class:"w-20 cursor-pointer underline text-red-700"}," 删除 ",-1),Oe=k(" 是否删除 "),Te={class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          "};y();var Je=e({props:{id:{type:String,required:!0},name:{type:String,required:!0}},setup(e){const t=e,n=s();r();let o=j({title:"",time:void 0,address:"",remark:"",description:"",pssx:[],yzry:[]}),v=j({nwj:"",ryj:"",description:"",remark:"",yghs:"",cc:""}),y=j({name:"",zw:"",dcsj:null,nrms:"",remark:""}),f=[{label:"内景",value:"内景"},{label:"外景",value:"外景"},{label:"外景 + 内景",value:"外景 + 内景"}];const x=[{label:"日景",value:"日景"},{label:"夜景",value:"夜景"}];_((()=>t.id),(()=>{console.log("============",t.id),P()}));const V=U((()=>{let e=0;for(const a of o.pssx){const t=Number(a.yghs);e=isNaN(t)?e:e+t}return e})),z=async()=>{y.name&&y.zw&&y.dcsj&&y.nrms?(o.yzry.push(JSON.parse(JSON.stringify(y))),y.name="",y.zw="",y.dcsj=null,y.nrms="",y.remark="",await B()):n.error("请填写完整的演职人员信息")},S=async()=>{v.nwj&&v.ryj&&v.description&&v.yghs&&v.cc?(o.pssx.push(JSON.parse(JSON.stringify(v))),v.nwj="",v.ryj="",v.description="",v.remark="",v.yghs="",v.cc="",await B()):n.error("请填写完整的拍摄顺序")},P=async()=>{const e=await(e=>{const a=localStorage.getItem("tg_detail:"+e);return a?Promise.resolve(JSON.parse(a)):Promise.resolve(null)})(t.id);o.title=e&&e.title?e.title:"",o.time=e&&e.time?e.time:null,o.address=e&&e.address?e.address:"",o.description=e&&e.description?e.description:"",o.remark=e&&e.remark?e.remark:"",o.pssx=e&&e.pssx?e.pssx:[],o.yzry=e&&e.yzry?e.yzry:[];for(const a of o.yzry)a.dcsj=Number(a&&a.dcsj||0)},B=async()=>{await((e,a)=>{try{const t=JSON.stringify(a);return localStorage.setItem("tg_detail:"+e,t),Promise.resolve()}catch(t){return Promise.reject()}})(t.id,o)};return i((()=>{P()})),(e,t)=>{const n=d("n-gradient-text"),s=d("n-divider"),r=d("n-input"),i=d("n-icon"),j=d("n-date-picker"),_=d("n-popselect"),U=d("n-popconfirm"),P=d("n-time-picker");return a(),c("div",ae,[w("div",te,[w("div",le,[l(n,{gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:u((()=>[ne])),_:1},8,["gradient"])]),l(s,{class:"w-custom"}),l(r,{size:"medium",style:{width:"680px"},class:"w-custom mt-5",type:"text",placeholder:"输入标题",value:p(o).title,"onUpdate:value":t[0]||(t[0]=e=>p(o).title=e),onBlur:B},null,8,["value"]),w("div",se,[l(i,{class:"mr-1"},{default:u((()=>[l(p(K))])),_:1}),re]),l(j,{size:"medium",style:{width:"680px"},class:"w-custom",placeholder:"拍摄时间",value:p(o).time,"onUpdate:value":t[1]||(t[1]=e=>p(o).time=e),type:"datetime",clearable:"",onBlur:B},null,8,["value"]),w("div",oe,[l(i,{class:"mr-1"},{default:u((()=>[l(p(q))])),_:1}),ie]),l(r,{size:"medium",style:{width:"680px"},class:"w-custom",type:"text",placeholder:"输入地址",value:p(o).address,"onUpdate:value":t[2]||(t[2]=e=>p(o).address=e),onBlur:B},null,8,["value"]),l(r,{style:{width:"680px"},size:"medium",class:"w-custom mt-5",type:"text",value:p(o).remark,"onUpdate:value":t[3]||(t[3]=e=>p(o).remark=e),placeholder:"输入备注(可选)",onBlur:B},null,8,["value"]),l(r,{style:{width:"680px"},size:"medium",class:"w-custom mt-5",type:"text",value:p(o).description,"onUpdate:value":t[4]||(t[4]=e=>p(o).description=e),placeholder:"内容描述",onBlur:B},null,8,["value"]),l(s,{class:"w-custom"}),l(n,{gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:u((()=>[de])),_:1},8,["gradient"]),l(s,{class:"w-custom"}),w("div",ce,[ue,(a(!0),c(h,null,g(p(o).pssx,((e,t)=>(a(),c("div",{class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          ",key:t},[w("span",pe,b(e.cc),1),l(_,{value:e.nwj,"onUpdate:value":[a=>e.nwj=a,B],options:p(f),size:"medium",trigger:"click"},{default:u((()=>[w("span",me,[k(b(e.nwj||"内景/外景")+" ",1),l(i,null,{default:u((()=>[l(p(O))])),_:1})])])),_:2},1032,["value","onUpdate:value","options"]),l(_,{value:e.ryj,"onUpdate:value":[a=>e.ryj=a,B],options:x,size:"medium",trigger:"click"},{default:u((()=>[w("span",ve,[k(b(e.ryj||"日景/夜景")+" ",1),l(i,null,{default:u((()=>[l(p(O))])),_:1})])])),_:2},1032,["value","onUpdate:value"]),C(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":a=>e.description=a,placeholder:"内容简述",onBlur:B},null,40,we),[[I,e.description]]),C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.remark=a,placeholder:"备注",onBlur:B},null,40,ye),[[I,e.remark]]),C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.yghs=a,type:"number",placeholder:"耗时",onBlur:B},null,40,fe),[[I,e.yghs]]),l(U,{onPositiveClick:e=>(async e=>{o.pssx.splice(e,1),await B()})(t)},{trigger:u((()=>[he])),default:u((()=>[ge])),_:2},1032,["onPositiveClick"])])))),128)),w("div",xe,[ke,w("span",be,b(p(V))+"小时 ",1),je]),w("div",_e,[C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":t[5]||(t[5]=e=>p(v).cc=e),placeholder:"场次"},null,512),[[I,p(v).cc]]),m(' <span class="w-20">{{ props.name }}</span> '),l(_,{value:p(v).nwj,"onUpdate:value":t[6]||(t[6]=e=>p(v).nwj=e),options:p(f),size:"medium",trigger:"click"},{default:u((()=>[w("span",Ue,[k(b(p(v).nwj||"内景/外景")+" ",1),l(i,null,{default:u((()=>[l(p(O))])),_:1})])])),_:1},8,["value","options"]),l(_,{value:p(v).ryj,"onUpdate:value":t[7]||(t[7]=e=>p(v).ryj=e),options:x,size:"medium",trigger:"click"},{default:u((()=>[w("span",Ce,[k(b(p(v).ryj||"日景/夜景")+" ",1),l(i,null,{default:u((()=>[l(p(O))])),_:1})])])),_:1},8,["value"]),C(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":t[8]||(t[8]=e=>p(v).description=e),placeholder:"内容简述"},null,512),[[I,p(v).description]]),C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":t[9]||(t[9]=e=>p(v).remark=e),placeholder:"备注"},null,512),[[I,p(v).remark]]),C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":t[10]||(t[10]=e=>p(v).yghs=e),type:"number",placeholder:"耗时"},null,512),[[I,p(v).yghs]]),w("span",{class:"w-14 cursor-pointer underline text-green-700",onClick:S}," 添加 ")])]),l(s,{class:"w-custom"}),l(n,{gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:u((()=>[Ie])),_:1},8,["gradient"]),l(s,{class:"w-custom"}),w("div",Ve,[ze,(a(!0),c(h,null,g(p(o).yzry,((e,t)=>(a(),c("div",{class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          ",key:t},[C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.name=a,placeholder:"姓名",onBlur:B},null,40,Se),[[I,e.name]]),C(w("input",{class:"hidden-input w-28","onUpdate:modelValue":a=>e.zw=a,placeholder:"职务",onBlur:B},null,40,Pe),[[I,e.zw]]),l(P,{class:"w-28 n-time-picker",value:e.dcsj,"onUpdate:value":a=>e.dcsj=a,placeholder:"到场时间",onBlur:B},null,8,["value","onUpdate:value"]),C(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":a=>e.nrms=a,placeholder:"备注",onBlur:B},null,40,Be),[[I,e.nrms]]),l(U,{onPositiveClick:e=>(async e=>{o.yzry.splice(e,1),await B()})(t)},{trigger:u((()=>[Ne])),default:u((()=>[Oe])),_:2},1032,["onPositiveClick"])])))),128)),w("div",Te,[C(w("input",{class:"hidden-input w-20","onUpdate:modelValue":t[11]||(t[11]=e=>p(y).name=e),placeholder:"姓名"},null,512),[[I,p(y).name]]),C(w("input",{class:"hidden-input w-28","onUpdate:modelValue":t[12]||(t[12]=e=>p(y).zw=e),placeholder:"职务"},null,512),[[I,p(y).zw]]),l(P,{class:"w-28 n-time-picker",value:p(y).dcsj,"onUpdate:value":t[13]||(t[13]=e=>p(y).dcsj=e),placeholder:"到场时间"},null,8,["value"]),C(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":t[14]||(t[14]=e=>p(y).nrms=e),placeholder:"备注"},null,512),[[I,p(y).nrms]]),w("span",{class:"w-20 cursor-pointer underline text-green-700",onClick:z}," 添加 ")])])])])}}});Je.__scopeId="data-v-389e094e",v("data-v-b7655332");const Ge={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},Me=k(" 所有项目 "),qe=k(" 项目统筹 "),Le=k("发送通告"),Ae=k("打印预览"),Ee={class:"sl-content flex"};y();var He=e({setup(e){const s=r(),o=z(),i=n(!1),c=n({id:"",name:"",projectId:""}),v=e=>{c.value=e},y=()=>{o.push({name:"ProjectHome"})},f=()=>{o.go(-1)};return(e,n)=>{const r=d("n-breadcrumb-item"),o=d("n-breadcrumb"),h=d("n-button"),g=d("n-space"),x=d("n-spin");return a(),t(x,{show:i.value},{default:u((()=>[w("div",Ge,[l(o,null,{default:u((()=>[l(r,{onClick:y},{default:u((()=>[Me])),_:1}),l(r,{onClick:f},{default:u((()=>[k(b(p(s).query.name),1)])),_:1}),l(r,null,{default:u((()=>[qe])),_:1})])),_:1}),l(g,null,{default:u((()=>[l(h,{type:"primary"},{default:u((()=>[Le])),_:1}),l(h,{type:"primary"},{default:u((()=>[Ae])),_:1})])),_:1})]),w("div",Ee,[l(ee,{onUpdateSelectedTG:v}),c.value.id?(a(),t(Je,{key:0,id:c.value.id,name:c.value.name},null,8,["id","name"])):m("v-if",!0)])])),_:1},8,["show"])}}});He.__scopeId="data-v-b7655332";export{He as default};
