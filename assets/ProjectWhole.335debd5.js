import{d as e,o as a,c as l,b as t,j as s,h as n,t as r,y as o,s as c,r as i,k as d,w as u,u as v,B as p,p as f,l as m,m as y,T as j,G as w,D as g,H as k,q as x,A as b,I,x as h,E as P,J as _,M as W,K as S,L as C,i as J}from"./vendor.882c7a74.js";import{V as N,E as O,A as U}from"./vue-draggable-next.esm-bundler.776c20e5.js";import{_ as V,C as M}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.05f4e946.js";import{g as q}from"./uuid.a7ba8b83.js";const L={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},B=t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),D=t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1);var H=e({name:"Add",render:function(e,t){return a(),l("svg",L,[B,D])}});const A=e=>{const a=localStorage.getItem("PWList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},E=e=>{const a=localStorage.getItem("PWList");if(a){const l=JSON.parse(a).filter((a=>a.projectId===e));if(l)return Promise.resolve(l)}return Promise.resolve([])},T=async e=>{if(e.id&&e.projectId){const a=await E(e.projectId),l=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===l?a.push(e):a[l]=e;const t=A(e.projectId);return localStorage.setItem("PWList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()};f("data-v-0fc96a6d");const G={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},K=m("div",{class:"mt-4"},"表单管理",-1),z=["onClick"],F=x(" 新建表单 ");y();var Q=e({emits:["updateSelectedPW","hidden"],setup(e,{emit:f}){const m=s([]),y=n(),I=r(),h=o(),P=s(!1),_=s({id:"",name:"",projectId:""}),W=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],S=async e=>{P.value=!1,"edit"===e&&await T(_.value),await D()},C=async()=>{const e={id:q(),projectId:I.query.id+"",name:"第"+(m.value.length+1)+"场"+q().substr(Math.floor(10*Math.random()+1),2)};try{await T(e),y.success("保存成功"),await D()}catch(a){y.error("保存失败")}},J=async()=>{try{await(async(e,a)=>{const l=A(a);return localStorage.setItem("PWList",JSON.stringify(l.concat(e))),Promise.resolve()})(m.value,I.query.id+""),await D()}catch(e){y.error("调整顺序失败")}},M=e=>{_.value=e,f("updateSelectedPW",e)},L=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await E(e.projectId),l=a.findIndex((a=>e.id===a.id));if(l>-1){a.splice(l,1);const t=A(e.projectId);return localStorage.setItem("PWList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),y.success("删除成功"),await D()}catch(a){y.error("删除失败")}},B=async e=>{"edit"===e&&(P.value=!0),"delete"===e&&h.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{L(_.value)}})},D=async()=>{try{m.value=await E(I.query.id+""),m.value.length>0?(M(m.value[0]),f("hidden",!0)):f("hidden",!1)}catch(e){y.error("获取分镜头列表失败")}};return c((()=>{D()})),(e,s)=>{const n=i("n-icon"),r=i("n-dropdown"),o=i("n-button");return a(),d("div",G,[K,t(v(N),{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),onChange:J},{default:u((()=>[t(j,null,{default:u((()=>[(a(!0),d(w,null,g(m.value,((e,l)=>(a(),d("div",{class:k(["PW-aside-item",e.id===_.value.id?"active":""]),key:l,onClick:a=>M(e)},[x(b(e.name||"新建表单"+(l+1))+" ",1),t(r,{trigger:"click",onSelect:B,options:W,"show-arrow":!0},{default:u((()=>[t(n,{class:"PW-aside-item-icon"},{default:u((()=>[t(v(O))])),_:1})])),_:1})],10,z)))),128))])),_:1})])),_:1},8,["modelValue"]),t(o,{class:"mt-4 w-56",onClick:C},{icon:u((()=>[t(n,null,{default:u((()=>[t(v(U))])),_:1})])),default:u((()=>[F])),_:1}),P.value?(a(),l(V,{key:0,showModal:P.value,inputVal:_.value.name,"onUpdate:inputVal":s[1]||(s[1]=e=>_.value.name=e),placeholder:"请输入新的名字",onCancelClick:s[2]||(s[2]=e=>S("cancel")),onConfirmClick:s[3]||(s[3]=e=>S("edit"))},null,8,["showModal","inputVal"])):p("v-if",!0)])}}});Q.__scopeId="data-v-0fc96a6d";const R=[{label:"外景",value:"外景"},{label:"内景",value:"内景"},{label:"外景+内景",value:"外景+内景"}],X=[{label:"日景",value:"日景"},{label:"夜景",value:"夜景"}],Y=[{label:"演员",key:"演员"},{label:"群演",key:"群演"},{label:"打斗/特技",key:"打斗/特技"},{label:"车辆",key:"车辆"},{label:"道具",key:"道具"},{label:"后期特效",key:"后期特效"},{label:"化妆/发型",key:"化妆/发型"},{label:"动物",key:"动物"},{label:"配乐",key:"配乐"},{label:"录音",key:"录音"},{label:"布景",key:"布景"},{label:"特殊设备",key:"特殊设备"},{label:"安保",key:"安保"},{label:"额外劳力",key:"额外劳力"},{label:"视觉效果",key:"视觉效果"},{label:"杂项",key:"杂项"}];f("data-v-6c1f1dee");const Z={class:"p-10 pt-5 flex-auto w-full"},$={class:"text-3xl pb-5"},ee={class:""},ae=S('<div class="flex items-center bg-gray-100 h-10 text-gray-500 text-sm" data-v-6c1f1dee><div class="w-40 pl-4" data-v-6c1f1dee>场景类型</div><div class="w-40 pl-2" data-v-6c1f1dee>场景时间</div><div class="w-40 pl-2" data-v-6c1f1dee>场景陈设</div><div class="flex-auto ml-4 pl-2.5" data-v-6c1f1dee>场景简述</div></div>',1),le={class:"flex items-center h-10 text-gray-500 text-sm mt-2.5"},te={class:"w-40 pl-4"},se={class:"flex items-center cursor-pointer"},ne={class:"w-40 pl-2"},re={class:"flex items-center cursor-pointer"},oe={key:1,class:"text-3xl pb-5"},ce={key:2,class:"flex items-center flex-wrap"},ie=x("点击选择元素");y();var de=e({props:{PWId:{type:String,required:!0},name:{type:String,required:!0}},setup(e){const r=e,o=n(),c=s({id:"",name:"",PWId:"",cj:{cjlx:"",cjsj:"",cjcs:"",cjjs:""},dj:[]});I((()=>r.PWId),(()=>{f()})),h((()=>{C((()=>{f()}))}));const f=async()=>{c.value=await(e=>{const a=localStorage.getItem("PWDetailInfo");let l;a&&(l=JSON.parse(a).find((a=>e===a.PWId)));return l||(l={id:"",name:"",PWId:"",cj:{cjlx:"",cjsj:"",cjcs:"",cjjs:""},dj:[]}),Promise.resolve(l)})(r.PWId)},y=async()=>{c.value.id||(c.value.id=q()),c.value.PWId||(c.value.PWId=r.PWId);try{await(async e=>{const a=localStorage.getItem("PWDetailInfo")||JSON.stringify([]),l=JSON.parse(a),t=l.findIndex((a=>e.PWId===a.PWId));return t>-1?l[t]=e:l.push(e),localStorage.setItem("PWDetailInfo",JSON.stringify(l)),Promise.resolve()})(c.value)}catch(e){o.error("保存失败")}},j=async e=>{c.value.dj.findIndex((a=>a.name===e))>-1?o.error("无法重复添加"):(c.value.dj.push({name:e,list:[]}),console.log("PWInfo.value.dj",c.value.dj),await y())};return(e,s)=>{const n=i("n-divider"),o=i("n-icon"),f=i("n-popselect"),k=i("n-input"),I=i("n-button"),h=i("n-dropdown");return a(),d("div",Z,[m("div",$,b(r.name),1),t(n),m("div",ee,[ae,m("div",le,[m("div",te,[t(f,{options:v(R),value:c.value.cj.cjlx,"onUpdate:value":[s[0]||(s[0]=e=>c.value.cj.cjlx=e),y],trigger:"click",scrollable:""},{default:u((()=>[m("div",se,[x(b(c.value.cj.cjlx||"类型")+" ",1),t(o,null,{default:u((()=>[t(v(M))])),_:1})])])),_:1},8,["options","value"])]),m("div",ne,[t(f,{options:v(X),value:c.value.cj.cjsj,"onUpdate:value":[s[1]||(s[1]=e=>c.value.cj.cjsj=e),y],trigger:"click",scrollable:""},{default:u((()=>[m("div",re,[x(b(c.value.cj.cjsj||"时间")+" ",1),t(o,null,{default:u((()=>[t(v(M))])),_:1})])])),_:1},8,["options","value"])]),P(m("input",{class:"input w-40","onUpdate:modelValue":s[2]||(s[2]=e=>c.value.cj.cjcs=e),type:"text",onBlur:y,placeholder:"请输入内容描述"},null,544),[[_,c.value.cj.cjcs]]),P(m("input",{class:"input ml-4 flex-auto","onUpdate:modelValue":s[3]||(s[3]=e=>c.value.cj.cjjs=e),type:"text",onBlur:y,placeholder:"请输入内容描述"},null,544),[[_,c.value.cj.cjjs]])])]),(a(!0),d(w,null,g(c.value.dj,((e,s)=>(a(),d("div",{key:s},[e.name?(a(),l(n,{key:0})):p("v-if",!0),e.name?(a(),d("div",oe,b(e.name),1)):p("v-if",!0),e.name?(a(),d("div",ce,[(a(!0),d(w,null,g(e.list,((t,s)=>(a(),l(k,{class:"w-40 mr-4",style:{"margin-right":"8px",width:"100px"},value:t,"onUpdate:value":a=>(async(e,a,l)=>{a.list[l]=e,await y()})(a,e,s),key:s,placeholder:"请输入",onBlur:y},null,8,["value","onUpdate:value"])))),128)),t(I,{class:"ml-4",onClick:W((a=>(async e=>{e.list.push(""),await y()})(e)),["stop"])},{default:u((()=>[t(o,null,{default:u((()=>[t(v(H))])),_:1})])),_:2},1032,["onClick"])])):p("v-if",!0)])))),128)),t(n),t(h,{trigger:"hover",onSelect:j,options:v(Y),style:{"max-height":"300px",overflow:"auto"}},{default:u((()=>[t(I,null,{default:u((()=>[ie])),_:1})])),_:1},8,["options"])])}}});de.__scopeId="data-v-6c1f1dee",f("data-v-56d7a5ca");const ue={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},ve=x(" 所有项目 "),pe=x(" 项目统筹 "),fe=x("打印预览"),me=x("分享"),ye={class:"sl-content flex"};y();var je=e({setup(e){const n=r(),o=J(),c=s(!1),d=s(!0),f=s({id:"",name:"",projectId:""}),y=e=>{f.value=e},j=()=>{o.push({name:"ProjectHome"})},w=e=>{d.value=e},g=()=>{o.go(-1)};return(e,s)=>{const r=i("n-breadcrumb-item"),o=i("n-breadcrumb"),k=i("n-button"),I=i("n-space"),h=i("n-spin");return a(),l(h,{show:c.value},{default:u((()=>[m("div",ue,[t(o,null,{default:u((()=>[t(r,{onClick:j},{default:u((()=>[ve])),_:1}),t(r,{onClick:g},{default:u((()=>[x(b(v(n).query.name),1)])),_:1}),t(r,null,{default:u((()=>[pe])),_:1})])),_:1}),t(I,null,{default:u((()=>[t(k,{type:"primary"},{default:u((()=>[fe])),_:1}),t(k,{type:"primary"},{default:u((()=>[me])),_:1})])),_:1})]),m("div",ye,[t(Q,{onHidden:w,onUpdateSelectedPW:y}),d.value?(a(),l(de,{key:0,PWId:f.value.id,name:f.value.name},null,8,["PWId","name"])):p("v-if",!0)])])),_:1},8,["show"])}}});je.__scopeId="data-v-56d7a5ca";export{je as default};
