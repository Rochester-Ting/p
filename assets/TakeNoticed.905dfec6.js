import{d as e,o as a,c as t,b as n,j as l,h as s,t as r,y as o,s as i,r as d,k as c,w as u,u as p,B as m,p as v,l as w,m as y,T as f,G as h,D as g,H as x,q as k,A as b,C as j,O as _,E as U,J as V,K as C,i as z}from"./vendor.882c7a74.js";import{V as I,_ as S,C as P}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.44a8a774.js";import{g as B}from"./uuid.a7ba8b83.js";import{E as N,A as O}from"./EllipsisHorizontalSharp.17c10d59.js";const T={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},J=n("path",{d:"M256 48c-79.5 0-144 61.39-144 137c0 87 96 224.87 131.25 272.49a15.77 15.77 0 0 0 25.5 0C304 409.89 400 272.07 400 185c0-75.61-64.5-137-144-137z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),G=n("circle",{cx:"256",cy:"192",r:"48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1);var q=e({name:"LocationOutline",render:function(e,n){return a(),t("svg",T,[J,G])}});const M={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},L=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 232v-80"},null,-1),E=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 88V72"},null,-1),A=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M132 132l-12-12"},null,-1),H=n("circle",{cx:"256",cy:"272",r:"32",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),W=n("path",{d:"M256 96a176 176 0 1 0 176 176A176 176 0 0 0 256 96z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1);var D=e({name:"StopwatchOutline",render:function(e,n){return a(),t("svg",M,[L,E,A,H,W])}});const K=e=>{const a=localStorage.getItem("TGList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},F=e=>{const a=localStorage.getItem("TGList");if(a){const t=JSON.parse(a).filter((a=>a.projectId===e));if(t)return Promise.resolve(t)}return Promise.resolve([])},Q=async e=>{if(e.id&&e.projectId){const a=await F(e.projectId),t=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===t?a.push(e):a[t]=e;const n=K(e.projectId);return localStorage.setItem("TGList",JSON.stringify(n.concat(a))),Promise.resolve()}return Promise.reject()};v("data-v-5868a466");const R={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},X=w("div",{class:"mt-4"},"通告管理",-1),Y=["onClick"],Z=k(" 新建通告 ");y();var $=e({emits:["updateSelectedTG","hidden"],setup(e,{emit:v}){const w=l([]),y=s(),j=r(),_=o(),U=l(!1),V=l({id:"",name:"",projectId:""}),C=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],z=async e=>{U.value=!1,"edit"===e&&await Q(V.value),await M()},P=async()=>{const e={id:B(),projectId:j.query.id+"",name:"第"+(w.value.length+1)+"场"};try{await Q(e),y.success("保存成功"),await M()}catch(a){y.error("保存失败")}},T=async()=>{try{await(async(e,a)=>{const t=K(a);return localStorage.setItem("TGList",JSON.stringify(t.concat(e))),Promise.resolve()})(w.value,j.query.id+""),await M()}catch(e){y.error("调整顺序失败")}},J=e=>{V.value=e,v("updateSelectedTG",e)},G=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await F(e.projectId),t=a.findIndex((a=>e.id===a.id));if(t>-1){a.splice(t,1);const n=K(e.projectId);return localStorage.setItem("TGList",JSON.stringify(n.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),y.success("删除成功"),await M()}catch(a){y.error("删除失败")}},q=async e=>{"edit"===e&&(U.value=!0),"delete"===e&&_.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{G(V.value)}})},M=async()=>{try{w.value=await F(j.query.id+""),w.value.length>0?(J(w.value[0]),v("hidden",!0)):v("hidden",!1)}catch(e){y.error("获取分镜头列表失败")}};return i((()=>{M()})),(e,l)=>{const s=d("n-icon"),r=d("n-dropdown"),o=d("n-button");return a(),c("div",R,[X,n(p(I),{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=e=>w.value=e),onChange:T},{default:u((()=>[n(f,null,{default:u((()=>[(a(!0),c(h,null,g(w.value,((e,t)=>(a(),c("div",{class:x(["TG-aside-item",e.id===V.value.id?"active":""]),key:t,onClick:a=>J(e)},[k(b(e.name||"新建通告"+(t+1))+" ",1),n(r,{trigger:"click",onSelect:q,options:C,"show-arrow":!0},{default:u((()=>[n(s,{class:"TG-aside-item-icon"},{default:u((()=>[n(p(N))])),_:1})])),_:1})],10,Y)))),128))])),_:1})])),_:1},8,["modelValue"]),n(o,{class:"mt-4 w-56",onClick:P},{icon:u((()=>[n(s,null,{default:u((()=>[n(p(O))])),_:1})])),default:u((()=>[Z])),_:1}),U.value?(a(),t(S,{key:0,showModal:U.value,inputVal:V.value.name,"onUpdate:inputVal":l[1]||(l[1]=e=>V.value.name=e),placeholder:"请输入新的名字",onCancelClick:l[2]||(l[2]=e=>z("cancel")),onConfirmClick:l[3]||(l[3]=e=>z("edit"))},null,8,["showModal","inputVal"])):m("v-if",!0)])}}});$.__scopeId="data-v-5868a466";v("data-v-389e094e");const ee={class:"m-10 mt-5 flex-auto w-full overflow-y-auto overflow-x-hidden"},ae={class:"\n        bg-gray-100\n        flex flex-col\n        items-center\n        pb-10\n        overflow-y-auto overflow-x-hidden\n      "},te={class:"flex items-center text-3xl mt-10"},ne=k(" 通告单通过 Wonder Wrap 制作 "),le={class:"mt-5 text-gray-500 text-gray-500 text-sm mb-2 flex items-center"},se=k("拍摄时间 "),re={class:"mt-5 text-gray-500 text-sm mb-2 flex items-center"},oe=k(" 拍摄地址 "),ie=k(" 拍摄顺序 "),de={class:"w-custom"},ce=C('<div class="\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          " data-v-389e094e><span class="w-20" data-v-389e094e>场次</span><span class="w-28" data-v-389e094e> 内景/外景 </span><span class="w-28" data-v-389e094e> 日景/夜景 </span><span class="flex-auto" data-v-389e094e>内容简述</span><span class="w-20" data-v-389e094e>备注</span><span class="w-20" data-v-389e094e>预估耗时(/h)</span><span class="w-14" data-v-389e094e>操作</span></div>',1),ue={class:"w-20"},pe={class:"w-28 cursor-pointer"},me={class:"w-28 cursor-pointer"},ve=["onUpdate:modelValue"],we=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],fe=w("span",{class:"w-14 cursor-pointer underline text-red-700"}," 删除 ",-1),he=k(" 是否删除 "),ge={class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          "},xe=C('<span class="w-20" data-v-389e094e>总计</span><span class="w-28 cursor-pointer" data-v-389e094e></span><span class="w-28 cursor-pointer" data-v-389e094e></span><span class="flex-auto" data-v-389e094e></span><span class="w-20" data-v-389e094e></span>',5),ke={class:"w-20"},be=w("span",{class:"w-14"},null,-1),je={class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          "},_e={class:"w-20"},Ue={class:"w-28 cursor-pointer"},Ve={style:{width:"100px"},class:"w-28 cursor-pointer"},Ce=k(" 演职人员 "),ze={class:"w-custom"},Ie=C('<div class="\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          " data-v-389e094e><span class="w-20" data-v-389e094e>姓名</span><span class="w-28" data-v-389e094e> 职务 </span><span class="w-28" data-v-389e094e> 到场时间 </span><span class="flex-auto" data-v-389e094e>内容简述</span><span class="w-20" data-v-389e094e>备注</span><span class="w-20" data-v-389e094e>操作</span></div>',1),Se=["onUpdate:modelValue"],Pe=["onUpdate:modelValue"],Be=["onUpdate:modelValue"],Ne=["onUpdate:modelValue"],Oe=w("span",{class:"w-20 cursor-pointer underline text-red-700"}," 删除 ",-1),Te=k(" 是否删除 "),Je={class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          "};y();var Ge=e({props:{id:{type:String,required:!0},name:{type:String,required:!0}},setup(e){const t=e,l=s(),o=r();let m=j({title:"",time:null,address:"",remark:"",description:"",pssx:[],yzry:[]}),v=j({nwj:"",ryj:"",description:"",remark:"",yghs:""}),y=j({name:"",zw:"",dcsj:null,nrms:"",remark:""}),f=[{label:"内景",value:"内景"},{label:"外景",value:"外景"}];const x=[{label:"日景",value:"日景"},{label:"夜景",value:"夜景"}],C=_((()=>{let e=0;for(const a of m.pssx){const t=Number(a.yghs);e=isNaN(t)?e:e+t}return e})),z=async()=>{y.name&&y.zw&&y.dcsj&&y.nrms?(m.yzry.push(JSON.parse(JSON.stringify(y))),y.name="",y.zw="",y.dcsj=null,y.nrms="",y.remark="",await B()):l.error("请填写完整的演职人员信息")},I=async()=>{v.nwj&&v.ryj&&v.description&&v.yghs?(m.pssx.push(JSON.parse(JSON.stringify(v))),v.nwj="",v.ryj="",v.description="",v.remark="",v.yghs="",await B()):l.error("请填写完整的拍摄顺序")},S=async()=>{const e=o.query.id+"",a=await(e=>{const a=localStorage.getItem("tg_detail:"+e);return a?Promise.resolve(JSON.parse(a)):Promise.resolve(null)})(e);if(a){m.title=a.title||"",m.time=a.time||null,m.address=a.address||"",m.description=a.description||"",m.remark=a.remark||"",m.pssx=a.pssx||"",m.yzry=a.yzry||"";for(const e of m.yzry)e.dcsj=Number(e.dcsj);console.log("res",a),console.log("detail",m)}},B=async()=>{const e=o.query.id+"";await((e,a)=>{try{const t=JSON.stringify(a);return localStorage.setItem("tg_detail:"+e,t),Promise.resolve()}catch(t){return Promise.reject()}})(e,m)};return i((()=>{S()})),(e,l)=>{const s=d("n-gradient-text"),r=d("n-divider"),o=d("n-input"),i=d("n-icon"),j=d("n-date-picker"),_=d("n-popselect"),S=d("n-popconfirm"),N=d("n-time-picker");return a(),c("div",ee,[w("div",ae,[w("div",te,[n(s,{gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:u((()=>[ne])),_:1},8,["gradient"])]),n(r,{class:"w-custom"}),n(o,{size:"medium",class:"w-custom mt-5",type:"text",placeholder:"输入标题",value:p(m).title,"onUpdate:value":l[0]||(l[0]=e=>p(m).title=e),onBlur:B},null,8,["value"]),w("div",le,[n(i,{class:"mr-1"},{default:u((()=>[n(p(D))])),_:1}),se]),n(j,{size:"medium",class:"w-custom",placeholder:"拍摄时间",value:p(m).time,"onUpdate:value":l[1]||(l[1]=e=>p(m).time=e),type:"date",clearable:"",onBlur:B},null,8,["value"]),w("div",re,[n(i,{class:"mr-1"},{default:u((()=>[n(p(q))])),_:1}),oe]),n(o,{size:"medium",class:"w-custom",type:"text",placeholder:"输入地址",value:p(m).address,"onUpdate:value":l[2]||(l[2]=e=>p(m).address=e),onBlur:B},null,8,["value"]),n(o,{size:"medium",class:"w-custom mt-5",type:"text",value:p(m).remark,"onUpdate:value":l[3]||(l[3]=e=>p(m).remark=e),placeholder:"输入备注(可选)",onBlur:B},null,8,["value"]),n(o,{size:"medium",class:"w-custom mt-5",type:"text",value:p(m).description,"onUpdate:value":l[4]||(l[4]=e=>p(m).description=e),placeholder:"内容描述",onBlur:B},null,8,["value"]),n(r,{class:"w-custom"}),n(s,{gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:u((()=>[ie])),_:1},8,["gradient"]),n(r,{class:"w-custom"}),w("div",de,[ce,(a(!0),c(h,null,g(p(m).pssx,((e,l)=>(a(),c("div",{class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          ",key:l},[w("span",ue,b(t.name),1),n(_,{value:e.nwj,"onUpdate:value":[a=>e.nwj=a,B],options:p(f),size:"medium",trigger:"click"},{default:u((()=>[w("span",pe,[k(b(e.nwj||"内景/外景")+" ",1),n(i,null,{default:u((()=>[n(p(P))])),_:1})])])),_:2},1032,["value","onUpdate:value","options"]),n(_,{value:e.ryj,"onUpdate:value":[a=>e.ryj=a,B],options:x,size:"medium",trigger:"click"},{default:u((()=>[w("span",me,[k(b(e.ryj||"日景/夜景")+" ",1),n(i,null,{default:u((()=>[n(p(P))])),_:1})])])),_:2},1032,["value","onUpdate:value"]),U(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":a=>e.description=a,placeholder:"内容简述",onBlur:B},null,40,ve),[[V,e.description]]),U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.remark=a,placeholder:"备注",onBlur:B},null,40,we),[[V,e.remark]]),U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.yghs=a,type:"number",placeholder:"耗时",onBlur:B},null,40,ye),[[V,e.yghs]]),n(S,{onPositiveClick:e=>(async e=>{m.pssx.splice(e,1),await B()})(l)},{trigger:u((()=>[fe])),default:u((()=>[he])),_:2},1032,["onPositiveClick"])])))),128)),w("div",ge,[xe,w("span",ke,b(p(C))+"小时 ",1),be]),w("div",je,[w("span",_e,b(t.name),1),n(_,{value:p(v).nwj,"onUpdate:value":l[5]||(l[5]=e=>p(v).nwj=e),options:p(f),size:"medium",trigger:"click"},{default:u((()=>[w("span",Ue,[k(b(p(v).nwj||"内景/外景")+" ",1),n(i,null,{default:u((()=>[n(p(P))])),_:1})])])),_:1},8,["value","options"]),n(_,{value:p(v).ryj,"onUpdate:value":l[6]||(l[6]=e=>p(v).ryj=e),options:p(f),size:"medium",trigger:"click"},{default:u((()=>[w("span",Ve,[k(b(p(v).ryj||"日景/夜景")+" ",1),n(i,null,{default:u((()=>[n(p(P))])),_:1})])])),_:1},8,["value","options"]),U(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":l[7]||(l[7]=e=>p(v).description=e),placeholder:"内容简述"},null,512),[[V,p(v).description]]),U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":l[8]||(l[8]=e=>p(v).remark=e),placeholder:"备注"},null,512),[[V,p(v).remark]]),U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":l[9]||(l[9]=e=>p(v).yghs=e),type:"number",placeholder:"耗时"},null,512),[[V,p(v).yghs]]),w("span",{class:"w-14 cursor-pointer underline text-green-700",onClick:I}," 添加 ")])]),n(r,{class:"w-custom"}),n(s,{gradient:{from:"rgb(85, 85, 85)",to:"rgb(170, 170, 170)"}},{default:u((()=>[Ce])),_:1},8,["gradient"]),n(r,{class:"w-custom"}),w("div",ze,[Ie,(a(!0),c(h,null,g(p(m).yzry,((e,t)=>(a(),c("div",{class:"\n            flex\n            items-center\n            h-10\n            text-gray-500 text-sm\n            border-solid border-b border-gray-300\n          ",key:t},[U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.name=a,placeholder:"姓名",onBlur:B},null,40,Se),[[V,e.name]]),U(w("input",{class:"hidden-input w-28","onUpdate:modelValue":a=>e.zw=a,placeholder:"职务",onBlur:B},null,40,Pe),[[V,e.zw]]),n(N,{class:"w-28 n-time-picker",value:e.dcsj,"onUpdate:value":a=>e.dcsj=a,placeholder:"到场时间",onBlur:B},null,8,["value","onUpdate:value"]),U(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":a=>e.nrms=a,placeholder:"内容简述",onBlur:B},null,40,Be),[[V,e.nrms]]),U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":a=>e.remark=a,placeholder:"备注",onBlur:B},null,40,Ne),[[V,e.remark]]),n(S,{onPositiveClick:e=>(async e=>{m.yzry.splice(e,1),await B()})(t)},{trigger:u((()=>[Oe])),default:u((()=>[Te])),_:2},1032,["onPositiveClick"])])))),128)),w("div",Je,[U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":l[10]||(l[10]=e=>p(y).name=e),placeholder:"姓名"},null,512),[[V,p(y).name]]),U(w("input",{class:"hidden-input w-28","onUpdate:modelValue":l[11]||(l[11]=e=>p(y).zw=e),placeholder:"职务"},null,512),[[V,p(y).zw]]),n(N,{class:"w-28 n-time-picker",value:p(y).dcsj,"onUpdate:value":l[12]||(l[12]=e=>p(y).dcsj=e),placeholder:"到场时间"},null,8,["value"]),U(w("input",{class:"hidden-input flex-auto","onUpdate:modelValue":l[13]||(l[13]=e=>p(y).nrms=e),placeholder:"内容简述"},null,512),[[V,p(y).nrms]]),U(w("input",{class:"hidden-input w-20","onUpdate:modelValue":l[14]||(l[14]=e=>p(y).remark=e),placeholder:"备注"},null,512),[[V,p(y).remark]]),w("span",{class:"w-20 cursor-pointer underline text-green-700",onClick:z}," 添加 ")])])])])}}});Ge.__scopeId="data-v-389e094e",v("data-v-b7655332");const qe={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},Me=k(" 所有项目 "),Le=k(" 项目统筹 "),Ee=k("发送通告"),Ae=k("打印预览"),He={class:"sl-content flex"};y();var We=e({setup(e){const s=r(),o=z(),i=l(!1),c=l({id:"",name:"",projectId:""}),m=e=>{c.value=e},v=()=>{o.push({name:"ProjectHome"})},y=()=>{o.go(-1)};return(e,l)=>{const r=d("n-breadcrumb-item"),o=d("n-breadcrumb"),f=d("n-button"),h=d("n-space"),g=d("n-spin");return a(),t(g,{show:i.value},{default:u((()=>[w("div",qe,[n(o,null,{default:u((()=>[n(r,{onClick:v},{default:u((()=>[Me])),_:1}),n(r,{onClick:y},{default:u((()=>[k(b(p(s).query.name),1)])),_:1}),n(r,null,{default:u((()=>[Le])),_:1})])),_:1}),n(h,null,{default:u((()=>[n(f,{type:"primary"},{default:u((()=>[Ee])),_:1}),n(f,{type:"primary"},{default:u((()=>[Ae])),_:1})])),_:1})]),w("div",He,[n($,{onUpdateSelectedTG:m}),n(Ge,{id:c.value.id,name:c.value.name},null,8,["id","name"])])])),_:1},8,["show"])}}});We.__scopeId="data-v-b7655332";export{We as default};
