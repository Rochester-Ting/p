import{d as e,o as a,c as l,b as t,j as s,h as n,t as r,y as o,s as c,r as i,k as d,w as u,u as v,B as p,p as f,l as m,m as j,T as y,G as w,D as b,H as g,q as k,A as x,I,x as h,E as P,J as _,M as W,K as S,L as C,i as O}from"./vendor.882c7a74.js";import{V as J,_ as N,C as V}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.44a8a774.js";import{g as L}from"./uuid.a7ba8b83.js";import{E as q,A as U}from"./EllipsisHorizontalSharp.17c10d59.js";const M={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},B=t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),D=t("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1);var E=e({name:"CloseOutline",render:function(e,t){return a(),l("svg",M,[B,D])}});const H=e=>{const a=localStorage.getItem("PWList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},T=e=>{const a=localStorage.getItem("PWList");if(a){const l=JSON.parse(a).filter((a=>a.projectId===e));if(l)return Promise.resolve(l)}return Promise.resolve([])},A=async e=>{if(e.id&&e.projectId){const a=await T(e.projectId),l=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===l?a.push(e):a[l]=e;const t=H(e.projectId);return localStorage.setItem("PWList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()};f("data-v-0fc96a6d");const z={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},G=m("div",{class:"mt-4"},"表单管理",-1),K=["onClick"],F=k(" 新建表单 ");j();var Q=e({emits:["updateSelectedPW","hidden"],setup(e,{emit:f}){const m=s([]),j=n(),I=r(),h=o(),P=s(!1),_=s({id:"",name:"",projectId:""}),W=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],S=async e=>{P.value=!1,"edit"===e&&await A(_.value),await D()},C=async()=>{const e={id:L(),projectId:I.query.id+"",name:"第"+(m.value.length+1)+"场"};try{await A(e),j.success("保存成功"),await D()}catch(a){j.error("保存失败")}},O=async()=>{try{await(async(e,a)=>{const l=H(a);return localStorage.setItem("PWList",JSON.stringify(l.concat(e))),Promise.resolve()})(m.value,I.query.id+""),await D()}catch(e){j.error("调整顺序失败")}},V=e=>{_.value=e,f("updateSelectedPW",e)},M=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await T(e.projectId),l=a.findIndex((a=>e.id===a.id));if(l>-1){a.splice(l,1);const t=H(e.projectId);return localStorage.setItem("PWList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),j.success("删除成功"),await D()}catch(a){j.error("删除失败")}},B=async e=>{"edit"===e&&(P.value=!0),"delete"===e&&h.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{M(_.value)}})},D=async()=>{try{m.value=await T(I.query.id+""),m.value.length>0?(V(m.value[0]),f("hidden",!0)):f("hidden",!1)}catch(e){j.error("获取分镜头列表失败")}};return c((()=>{D()})),(e,s)=>{const n=i("n-icon"),r=i("n-dropdown"),o=i("n-button");return a(),d("div",z,[G,t(v(J),{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=e=>m.value=e),onChange:O},{default:u((()=>[t(y,null,{default:u((()=>[(a(!0),d(w,null,b(m.value,((e,l)=>(a(),d("div",{class:g(["PW-aside-item",e.id===_.value.id?"active":""]),key:l,onClick:a=>V(e)},[k(x(e.name||"新建表单"+(l+1))+" ",1),t(r,{trigger:"click",onSelect:B,options:W,"show-arrow":!0},{default:u((()=>[t(n,{class:"PW-aside-item-icon"},{default:u((()=>[t(v(q))])),_:1})])),_:1})],10,K)))),128))])),_:1})])),_:1},8,["modelValue"]),t(o,{class:"mt-4 w-56",onClick:C},{icon:u((()=>[t(n,null,{default:u((()=>[t(v(U))])),_:1})])),default:u((()=>[F])),_:1}),P.value?(a(),l(N,{key:0,showModal:P.value,inputVal:_.value.name,"onUpdate:inputVal":s[1]||(s[1]=e=>_.value.name=e),placeholder:"请输入新的名字",onCancelClick:s[2]||(s[2]=e=>S("cancel")),onConfirmClick:s[3]||(s[3]=e=>S("edit"))},null,8,["showModal","inputVal"])):p("v-if",!0)])}}});Q.__scopeId="data-v-0fc96a6d";const R=async e=>{const a=localStorage.getItem("PWDetailInfo")||JSON.stringify([]),l=JSON.parse(a),t=l.findIndex((a=>e.PWId===a.PWId));return t>-1?l[t]=e:l.push(e),localStorage.setItem("PWDetailInfo",JSON.stringify(l)),Promise.resolve()},X=[{label:"外景",value:"外景"},{label:"内景",value:"内景"},{label:"外景+内景",value:"外景+内景"}],Y=[{label:"日景",value:"日景"},{label:"夜景",value:"夜景"}];f("data-v-6c1f1dee");const Z={class:"p-10 pt-5 flex-auto w-full"},$={class:"text-3xl pb-5"},ee={class:""},ae=S('<div class="flex items-center bg-gray-100 h-10 text-gray-500 text-sm" data-v-6c1f1dee><div class="w-40 pl-4" data-v-6c1f1dee>场景类型</div><div class="w-40 pl-2" data-v-6c1f1dee>场景时间</div><div class="w-40 pl-2" data-v-6c1f1dee>场景陈设</div><div class="flex-auto ml-4 pl-2.5" data-v-6c1f1dee>场景简述</div></div>',1),le={class:"flex items-center h-10 text-gray-500 text-sm mt-2.5"},te={class:"w-40 pl-4"},se={class:"flex items-center cursor-pointer"},ne={class:"w-40 pl-2"},re={class:"flex items-center cursor-pointer"},oe=m("div",{class:"text-3xl pb-5"},"道具",-1),ce={class:"flex flex-wrap"},ie=k("点击选择道具");j();var de=e({props:{PWId:{type:String,required:!0},name:{type:String,required:!0}},setup(e){const l=e,r=n(),o=s({id:"",name:"",PWId:"",cj:{cjlx:"",cjsj:"",cjcs:"",cjjs:""},dj:[]}),c=[{label:"演员",key:"演员"},{label:"群演",key:"群演"},{label:"打斗/特技",key:"打斗/特技"},{label:"车辆",key:"车辆"},{label:"道具",key:"道具"},{label:"后期特效",key:"后期特效"},{label:"化妆/发型",key:"化妆/发型"},{label:"动物",key:"动物"},{label:"配乐",key:"配乐"},{label:"录音",key:"录音"},{label:"布景",key:"布景"},{label:"特殊设备",key:"特殊设备"},{label:"安保",key:"安保"},{label:"额外劳力",key:"额外劳力"},{label:"视觉效果",key:"视觉效果"},{label:"杂项",key:"杂项"}];I((()=>l.PWId),(()=>{p()})),h((()=>{C((()=>{p()}))}));const p=async()=>{o.value=await(e=>{const a=localStorage.getItem("PWDetailInfo");let l;a&&(l=JSON.parse(a).find((a=>e===a.PWId)));return l||(l={id:"",name:"",PWId:"",cj:{cjlx:"",cjsj:"",cjcs:"",cjjs:""},dj:[]}),Promise.resolve(l)})(l.PWId)},f=async()=>{o.value.id||(o.value.id=L()),o.value.PWId||(o.value.PWId=l.PWId);try{await R(o.value)}catch(e){r.error("保存失败")}},j=async e=>{o.value.dj.indexOf(e)>-1?r.error("无法重复添加"):(o.value.dj.push(e),await R(o.value))};return(e,s)=>{const n=i("n-divider"),r=i("n-icon"),p=i("n-popselect"),y=i("n-button"),g=i("n-dropdown");return a(),d("div",Z,[m("div",$,x(l.name),1),t(n),m("div",ee,[ae,m("div",le,[m("div",te,[t(p,{options:v(X),value:o.value.cj.cjlx,"onUpdate:value":[s[0]||(s[0]=e=>o.value.cj.cjlx=e),f],trigger:"click",scrollable:""},{default:u((()=>[m("div",se,[k(x(o.value.cj.cjlx||"类型")+" ",1),t(r,null,{default:u((()=>[t(v(V))])),_:1})])])),_:1},8,["options","value"])]),m("div",ne,[t(p,{options:v(Y),value:o.value.cj.cjsj,"onUpdate:value":[s[1]||(s[1]=e=>o.value.cj.cjsj=e),f],trigger:"click",scrollable:""},{default:u((()=>[m("div",re,[k(x(o.value.cj.cjsj||"时间")+" ",1),t(r,null,{default:u((()=>[t(v(V))])),_:1})])])),_:1},8,["options","value"])]),P(m("input",{class:"input w-40","onUpdate:modelValue":s[2]||(s[2]=e=>o.value.cj.cjcs=e),type:"text",onBlur:f,placeholder:"请输入内容描述"},null,544),[[_,o.value.cj.cjcs]]),P(m("input",{class:"input ml-4 flex-auto","onUpdate:modelValue":s[3]||(s[3]=e=>o.value.cj.cjjs=e),type:"text",onBlur:f,placeholder:"请输入内容描述"},null,544),[[_,o.value.cj.cjjs]])])]),t(n),oe,m("div",ce,[(a(!0),d(w,null,b(o.value.dj,((e,l)=>(a(),d("div",{class:"\n          w-32\n          h-32\n          flex\n          items-center\n          justify-center\n          border border-solid border-gray-100\n          mr-5\n          rounded\n          mb-5\n          relative\n          dj-item\n        ",key:l},[t(r,{class:"dj-icon absolute top-2 right-2",onClick:W((a=>(async e=>{const a=o.value.dj.indexOf(e);-1!==a&&(o.value.dj.splice(a,1),await R(o.value))})(e)),["stop"])},{default:u((()=>[t(v(E))])),_:2},1032,["onClick"]),k(" "+x(e),1)])))),128))]),t(n),t(g,{trigger:"hover",onSelect:j,options:c,style:{"max-height":"300px",overflow:"auto"}},{default:u((()=>[t(y,null,{default:u((()=>[ie])),_:1})])),_:1})])}}});de.__scopeId="data-v-6c1f1dee",f("data-v-56d7a5ca");const ue={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},ve=k(" 所有项目 "),pe=k(" 项目统筹 "),fe=k("打印预览"),me=k("分享"),je={class:"sl-content flex"};j();var ye=e({setup(e){const n=r(),o=O(),c=s(!1),d=s(!0),f=s({id:"",name:"",projectId:""}),j=e=>{f.value=e},y=()=>{o.push({name:"ProjectHome"})},w=e=>{d.value=e},b=()=>{o.go(-1)};return(e,s)=>{const r=i("n-breadcrumb-item"),o=i("n-breadcrumb"),g=i("n-button"),I=i("n-space"),h=i("n-spin");return a(),l(h,{show:c.value},{default:u((()=>[m("div",ue,[t(o,null,{default:u((()=>[t(r,{onClick:y},{default:u((()=>[ve])),_:1}),t(r,{onClick:b},{default:u((()=>[k(x(v(n).query.name),1)])),_:1}),t(r,null,{default:u((()=>[pe])),_:1})])),_:1}),t(I,null,{default:u((()=>[t(g,{type:"primary"},{default:u((()=>[fe])),_:1}),t(g,{type:"primary"},{default:u((()=>[me])),_:1})])),_:1})]),m("div",je,[t(Q,{onHidden:w,onUpdateSelectedPW:j}),d.value?(a(),l(de,{key:0,PWId:f.value.id,name:f.value.name},null,8,["PWId","name"])):p("v-if",!0)])])),_:1},8,["show"])}}});ye.__scopeId="data-v-56d7a5ca";export{ye as default};
