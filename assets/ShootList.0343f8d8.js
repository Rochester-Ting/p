import{d as e,h as a,u as l,q as t,v as s,m as o,r as n,i as r,a as u,w as c,A as i,c as d,y as p,p as v,j as f,k as m,o as h,T as b,F as y,B as w,E as g,l as j,x,t as I,G as S,C as _,H as k,I as U,J as V,g as P}from"./vendor.6e217547.js";import{V as C,_ as J,C as N}from"./ProjectEditModal.vue_vue&type=script&setup=true&lang.591f3c91.js";import{g as O,E as L,A as q}from"./uuid.4ba239b0.js";const D=e=>{const a=localStorage.getItem("shootList");if(a){return JSON.parse(a).filter((a=>a.projectId!==e))||[]}return[]},z=e=>{const a=localStorage.getItem("shootList");if(a){const l=JSON.parse(a).filter((a=>a.projectId===e));if(l)return Promise.resolve(l)}return Promise.resolve([])},B=async e=>{if(e.id&&e.projectId){const a=await z(e.projectId),l=a.findIndex((a=>e.id===a.id&&a.projectId===e.projectId));-1===l?a.push(e):a[l]=e;const t=D(e.projectId);return localStorage.setItem("shootList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()};v("data-v-052684fc");const T={class:"\n      flex flex-col\n      items-center\n      w-60\n      bg-gray-100\n      overflow-auto\n      flex-shrink-0\n    "},E=f("div",{class:"mt-4"},"分镜头列表",-1),M=["onClick"],A=j(" 新建分镜头 ");m();var H=e({emits:["updateSelectedSL"],setup(e,{emit:v}){const f=a([]),m=l(),I=t(),S=s(),_=a(!1),k=a({id:"",name:"",projectId:""}),U=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],V=async e=>{_.value=!1,"edit"===e&&await B(k.value),await K()},P=async()=>{const e={id:O(),projectId:I.query.id+"",name:"第"+(f.value.length+1)+"场"};try{await B(e),m.success("保存成功"),await K()}catch(a){m.error("保存失败")}},N=async()=>{try{await(async(e,a)=>{const l=D(a);return localStorage.setItem("shootList",JSON.stringify(l.concat(e))),Promise.resolve()})(f.value,I.query.id+""),await K()}catch(e){m.error("调整顺序失败")}},H=e=>{k.value=e,v("updateSelectedSL",e)},F=async e=>{try{await(async e=>{if(e.id&&e.projectId){const a=await z(e.projectId),l=a.findIndex((a=>e.id===a.id));if(l>-1){a.splice(l,1);const t=D(e.projectId);return localStorage.setItem("shootList",JSON.stringify(t.concat(a))),Promise.resolve()}return Promise.reject()}return Promise.reject()})(e),m.success("删除成功"),await K()}catch(a){m.error("删除失败")}},G=async e=>{"edit"===e&&(_.value=!0),"delete"===e&&S.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{F(k.value)}})},K=async()=>{try{f.value=await z(I.query.id+""),f.value.length>0&&H(f.value[0])}catch(e){m.error("获取分镜头列表失败")}};return o((()=>{K()})),(e,a)=>{const l=n("n-icon"),t=n("n-dropdown"),s=n("n-button");return h(),r("div",T,[E,u(i(C),{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onChange:N},{default:c((()=>[u(b,null,{default:c((()=>[(h(!0),r(y,null,w(f.value,((e,a)=>(h(),r("div",{class:g(["sl-aside-item",e.id===k.value.id?"active":""]),key:a,onClick:a=>H(e)},[j(x(e.name||"新建分镜头"+(a+1))+" ",1),u(t,{trigger:"click",onSelect:G,options:U,"show-arrow":!0},{default:c((()=>[u(l,{class:"sl-aside-item-icon"},{default:c((()=>[u(i(L))])),_:1})])),_:1})],10,M)))),128))])),_:1})])),_:1},8,["modelValue"]),u(s,{class:"mt-4 w-56",onClick:P},{icon:c((()=>[u(l,null,{default:c((()=>[u(i(q))])),_:1})])),default:c((()=>[A])),_:1}),_.value?(h(),d(J,{key:0,showModal:_.value,inputVal:k.value.name,"onUpdate:inputVal":a[1]||(a[1]=e=>k.value.name=e),placeholder:"请输入新的名字",onCancelClick:a[2]||(a[2]=e=>V("cancel")),onConfirmClick:a[3]||(a[3]=e=>V("edit"))},null,8,["showModal","inputVal"])):p("v-if",!0)])}}});H.__scopeId="data-v-052684fc";const F=e=>{const a=localStorage.getItem("shootDetail");if(a){const l=JSON.parse(a);return Promise.resolve(l.filter((a=>e===a.shootId))||[])}return Promise.resolve([])},G=e=>{const a=localStorage.getItem("shootDetail")||JSON.stringify([]);return JSON.parse(a).filter((a=>e!==a.shootId))},K=[{label:"超远景",value:"超远景"},{label:"远景",value:"远景"},{label:"全景",value:"全景"},{label:"中景",value:"中景"},{label:"近景",value:"近景"},{label:"特写",value:"特写"},{label:"大特写",value:"大特写"},{label:"自定义",value:"自定义"}],Q=[{label:"固定",value:"固定"},{label:"推动",value:"推动"},{label:"拉动",value:"拉动"},{label:"摇动",value:"摇动"},{label:"甩动",value:"甩动"},{label:"移动",value:"移动"},{label:"跟拍",value:"跟拍"},{label:"上升",value:"上升"},{label:"下降",value:"下降"}],R=[{label:"低角度",value:"低角度"},{label:"高角度",value:"高角度"},{label:"俯视角度",value:"俯视角度"},{label:"视线高度",value:"视线高度"},{label:"地面高度",value:"地面高度"}];v("data-v-7e9fd0bd");const W={class:"p-10 pt-5 flex-auto w-full"},X={class:"text-3xl pb-5"},Y=U('<div class="flex items-center h-10 bg-gray-50 text-gray-500 text-sm" data-v-7e9fd0bd><span class="w-20 pl-2" data-v-7e9fd0bd>场次</span><span class="w-20 pl-2" data-v-7e9fd0bd>镜号</span><span class="flex-auto pl-2" data-v-7e9fd0bd>内容描述</span><span class="w-32 pl-4" data-v-7e9fd0bd>景别</span><span class="w-32 pl-4" data-v-7e9fd0bd>镜头类型</span><span class="w-40 pl-4" data-v-7e9fd0bd>机位运动</span><span class="w-40 pl-2" data-v-7e9fd0bd>备注</span><span class="w-32 pl-4" data-v-7e9fd0bd>操作</span></div>',1),Z=["onUpdate:modelValue"],$=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],ae={class:"w-32 pl-4"},le={class:"flex items-center cursor-pointer"},te={class:"w-32 pl-4"},se={class:"flex items-center cursor-pointer"},oe={class:"w-40 pl-4"},ne={class:"flex items-center cursor-pointer"},re=["onUpdate:modelValue"],ue=["onClick"],ce={class:"flex items-center h-10 text-gray-500 text-sm text-gray-500"},ie={class:"w-32 pl-4"},de={class:"flex items-center cursor-pointer"},pe={class:"w-32 pl-4"},ve={class:"flex items-center cursor-pointer"},fe={class:"w-40 pl-4"},me={class:"flex items-center cursor-pointer"};m();var he=e({props:{name:{type:String,required:!0},shootId:{type:String,required:!0}},setup(e){const t=e,s=a(!1),o=l(),d=a([]),p=a({id:"",shootId:"",cc:"",jh:"",nrms:"",jb:"",jwyd:"",bz:""});I((()=>{V((()=>{m(t.shootId)}))})),S((()=>t.shootId),(()=>{m(t.shootId)}));const v=async()=>{try{await(async e=>{const a=G(e[0].shootId).concat(e);return localStorage.setItem("shootDetail",JSON.stringify(a)),Promise.resolve()})(d.value),await F(t.shootId)}catch(e){o.error("保存失败")}},m=async e=>{s.value=!0,d.value=await F(e),setTimeout((()=>{s.value=!1}),800)},b=async()=>{try{if(p.value.id=O(),p.value.shootId=t.shootId,!(p.value.id&&p.value.shootId&&p.value.cc&&p.value.jh&&p.value.nrms&&p.value.jb&&p.value.jwyd))return void o.error("请填写完整分镜头");await(async e=>{const a=localStorage.getItem("shootDetail")||JSON.stringify([]),l=JSON.parse(a);return l.push(e),localStorage.setItem("shootDetail",JSON.stringify(l)),Promise.resolve()})(p.value),p.value={id:"",shootId:"",cc:"",jh:"",nrms:"",jb:"",jwyd:"",bz:""},await m(t.shootId)}catch(e){o.error("保存失败")}},g=async e=>{try{await(async e=>{const a=localStorage.getItem("shootDetail")||JSON.stringify([]),l=JSON.parse(a),t=l.findIndex((a=>a.id===e.id));return-1===t?Promise.reject():(l.splice(t,1),localStorage.setItem("shootDetail",JSON.stringify(l)),Promise.resolve())})(e),o.success("删除成功"),await m(t.shootId)}catch(a){o.error("删除失败")}};return(e,a)=>{const l=n("n-icon"),s=n("n-popselect");return h(),r("div",W,[f("div",X,x(t.name),1),f("div",null,[Y,(h(!0),r(y,null,w(d.value,((e,a)=>(h(),r("div",{class:"\n          flex\n          items-center\n          w-full\n          h-10\n          text-gray-500 text-sm text-gray-500\n        ",key:a},[_(f("input",{class:"input w-20 h-10","onUpdate:modelValue":a=>e.cc=a,type:"text",onBlur:v,placeholder:"场次"},null,40,Z),[[k,e.cc]]),_(f("input",{class:"input w-20 h-10","onUpdate:modelValue":a=>e.jh=a,type:"text",onBlur:v,placeholder:"镜号"},null,40,$),[[k,e.jh]]),_(f("input",{class:"input flex-auto","onUpdate:modelValue":a=>e.nrms=a,type:"text",onBlur:v,placeholder:"请输入内容描述"},null,40,ee),[[k,e.nrms]]),f("div",ae,[u(s,{options:i(K),value:e.jb,"onUpdate:value":[a=>e.jb=a,v],trigger:"click",scrollable:""},{default:c((()=>[f("div",le,[j(x(e.jb||"景别")+" ",1),u(l,null,{default:c((()=>[u(i(N))])),_:1})])])),_:2},1032,["options","value","onUpdate:value"])]),f("div",te,[u(s,{options:i(R),value:e.jtlx,"onUpdate:value":[a=>e.jtlx=a,v],trigger:"click",scrollable:""},{default:c((()=>[f("div",se,[j(x(e.jtlx||"镜头类型")+" ",1),u(l,null,{default:c((()=>[u(i(N))])),_:1})])])),_:2},1032,["options","value","onUpdate:value"])]),f("div",oe,[u(s,{options:i(Q),value:e.jwyd,"onUpdate:value":[a=>e.jwyd=a,v],trigger:"click",scrollable:""},{default:c((()=>[f("div",ne,[j(x(e.jwyd||"机位运动")+" ",1),u(l,null,{default:c((()=>[u(i(N))])),_:1})])])),_:2},1032,["options","value","onUpdate:value"])]),_(f("input",{class:"input w-40","onUpdate:modelValue":a=>e.bz=a,type:"text",onBlur:v,placeholder:"请输入内容描述"},null,40,re),[[k,e.bz]]),f("span",{class:"w-32 pl-4 cursor-pointer underline text-red-700",onClick:a=>g(e)}," 删除 ",8,ue)])))),128)),f("div",ce,[_(f("input",{class:"input w-20 h-10","onUpdate:modelValue":a[0]||(a[0]=e=>p.value.cc=e),type:"text",placeholder:"场次"},null,512),[[k,p.value.cc]]),_(f("input",{class:"input w-20 h-10","onUpdate:modelValue":a[1]||(a[1]=e=>p.value.jh=e),type:"text",placeholder:"镜号"},null,512),[[k,p.value.jh]]),_(f("input",{class:"input flex-auto","onUpdate:modelValue":a[2]||(a[2]=e=>p.value.nrms=e),type:"text",placeholder:"请输入内容描述"},null,512),[[k,p.value.nrms]]),f("div",ie,[u(s,{options:i(K),value:p.value.jb,"onUpdate:value":a[3]||(a[3]=e=>p.value.jb=e),trigger:"click",scrollable:""},{default:c((()=>[f("div",de,[j(x(p.value.jb||"景别")+" ",1),u(l,null,{default:c((()=>[u(i(N))])),_:1})])])),_:1},8,["options","value"])]),f("div",pe,[u(s,{options:i(R),value:p.value.jtlx,"onUpdate:value":a[4]||(a[4]=e=>p.value.jtlx=e),trigger:"click",scrollable:""},{default:c((()=>[f("div",ve,[j(x(p.value.jtlx||"镜头类型")+" ",1),u(l,null,{default:c((()=>[u(i(N))])),_:1})])])),_:1},8,["options","value"])]),f("div",fe,[u(s,{options:i(Q),value:p.value.jwyd,"onUpdate:value":a[5]||(a[5]=e=>p.value.jwyd=e),trigger:"click",scrollable:""},{default:c((()=>[f("div",me,[j(x(p.value.jwyd||"机位运动")+" ",1),u(l,null,{default:c((()=>[u(i(N))])),_:1})])])),_:1},8,["options","value"])]),_(f("input",{class:"input w-40","onUpdate:modelValue":a[6]||(a[6]=e=>p.value.bz=e),type:"text",placeholder:"请输入内容描述"},null,512),[[k,p.value.bz]]),f("div",{class:"w-32 pl-4 cursor-pointer underline text-green-700",onClick:b}," 添加 ")])])])}}});he.__scopeId="data-v-7e9fd0bd",v("data-v-2524e697");const be={class:"\n        w-full\n        h-16\n        border-b border-solid border-gray-100\n        flex\n        items-center\n        px-10\n        justify-between\n      "},ye=j(" 所有项目 "),we=j(" 分镜头列表 "),ge=j("打印预览"),je=j("分享"),xe={class:"sl-content flex"};m();var Ie=e({setup(e){const l=t(),s=P(),o=a(!1),r=a({id:"",name:"",projectId:""}),v=e=>{r.value=e},m=()=>{s.push({name:"ProjectHome"})},b=()=>{s.go(-1)};return(e,a)=>{const t=n("n-breadcrumb-item"),s=n("n-breadcrumb"),y=n("n-button"),w=n("n-space"),g=n("n-spin");return h(),d(g,{show:o.value},{default:c((()=>[f("div",be,[u(s,null,{default:c((()=>[u(t,{onClick:m},{default:c((()=>[ye])),_:1}),u(t,{onClick:b},{default:c((()=>[j(x(i(l).query.name),1)])),_:1}),u(t,null,{default:c((()=>[we])),_:1})])),_:1}),u(w,null,{default:c((()=>[u(y,null,{default:c((()=>[ge])),_:1}),u(y,null,{default:c((()=>[je])),_:1})])),_:1})]),f("div",xe,[u(H,{onUpdateSelectedSL:v}),r.value.id?(h(),d(he,{key:0,shootId:r.value.id,name:r.value.name},null,8,["shootId","name"])):p("v-if",!0)])])),_:1},8,["show"])}}});Ie.__scopeId="data-v-2524e697";export{Ie as default};
