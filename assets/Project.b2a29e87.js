import{d as e,h as a,j as l,x as t,r as n,c as o,w as r,o as i,l as s,b as u,q as c,i as d,y as v,k as p,u as m,A as f,B as w,C as h,t as y,D as k,E as g,F as C,G as j,s as b,p as x,m as P,T as _,H as V}from"./vendor.882c7a74.js";import{E as I,A as S,V as M}from"./vue-draggable-next.esm-bundler.776c20e5.js";import{c as q,u as T,d as D,g as G,s as U}from"./cover.a765defc.js";import{g as L}from"./uuid.a7ba8b83.js";const N=()=>{const e=localStorage.getItem("allProjectGroup");return e?Promise.resolve(JSON.parse(e)):Promise.resolve([])},A=(e=[])=>{setTimeout((()=>(localStorage.setItem("allProjectGroup",JSON.stringify(e)),Promise.resolve())),800)},B=s("div",null,"提示",-1),E=c(" 取消 "),H=c(" 确定 ");var J=e({props:{showModal:{type:Boolean,required:!0},inputVal:{type:String,required:!0},placeholder:{type:String,required:!0}},emits:["cancelClick","confirmClick","update:inputVal"],setup(e,{emit:c}){const d=e,v=a(),p=l("");t((()=>{p.value=d.inputVal}));const m=()=>{console.log("cancelClick"),c("cancelClick")},f=()=>{p.value?(c("update:inputVal",p.value),setTimeout((()=>{c("confirmClick")}),300)):v.error("请输入内容")};return(e,a)=>{const l=n("n-input"),t=n("n-button"),c=n("n-modal");return i(),o(c,{show:d.showModal,"show-icon":!1,preset:"dialog",title:"Dialog"},{header:r((()=>[B])),action:r((()=>[s("div",null,[u(t,{class:"mr-4",onClick:m},{default:r((()=>[E])),_:1}),u(t,{type:"error",onClick:f},{default:r((()=>[H])),_:1})])])),default:r((()=>[s("div",null,[u(l,{value:p.value,"onUpdate:value":a[0]||(a[0]=e=>p.value=e),placeholder:d.placeholder},null,8,["value","placeholder"])])])),_:1},8,["show"])}}});const O={class:"\n      h-44\n      w-80\n      bg-white\n      flex\n      mb-5\n      mr-5\n      cursor-pointer\n      rounded\n      overflow-hidden\n    "},F={class:"flex-auto"},z={class:"p-3 underline flex items-center flex justify-between"};var K=e({props:{id:{type:String,required:!0,default:""},name:{type:String,required:!0,default:""},parentId:{type:String,required:!0,default:""}},emits:["updateProjectDetail"],setup(e,{emit:c}){const y=e,k=d(),g=l("");t((()=>{g.value=y.name}));const C=a(),j=v(),b=l(!1),x=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],P=()=>{k.push({name:"ProjectDetail",query:{id:y.id,parentId:y.parentId}})},_=async()=>{b.value=!1;const e=h({id:"",name:""});e.id=y.id,e.name=g.value;try{await T(y.parentId,e),c("updateProjectDetail"),C.success("修改成功!")}catch(a){C.error("修改失败")}},V=async e=>{"edit"===e&&(b.value=!0),"delete"===e&&j.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{(async()=>{try{await D(y.parentId,{id:y.id,name:y.name}),c("updateProjectDetail"),C.success("删除成功!")}catch(e){C.error("删除失败")}})()}})};return(e,a)=>{const l=n("n-image"),t=n("n-icon"),c=n("n-dropdown");return i(),p("div",O,[u(l,{onClick:P,class:"flex-shrink-0",width:"150",src:m(q)},null,8,["src"]),s("div",F,[s("div",z,[s("span",{class:"truncate w-28",onClick:P},f(y.name),1),u(c,{trigger:"click",onSelect:V,options:x,"show-arrow":!0},{default:r((()=>[u(t,{class:"ml-3 project-aside-item-icon"},{default:r((()=>[u(m(I))])),_:1})])),_:1})])]),b.value?(i(),o(J,{key:0,showModal:b.value,inputVal:g.value,"onUpdate:inputVal":a[0]||(a[0]=e=>g.value=e),placeholder:"请输入项目名字",onCancelClick:a[1]||(a[1]=e=>b.value=!1),onConfirmClick:_},null,8,["showModal","inputVal"])):w("v-if",!0)])}}}),Q=e({setup(e){const a=y().matched;return(e,l)=>{const t=n("n-breadcrumb-item"),s=n("n-breadcrumb");return i(),o(s,null,{default:r((()=>[(i(!0),p(j,null,k(m(a),((e,a)=>g((i(),o(t,{key:a},{default:r((()=>[c(f(e.meta.name),1)])),_:2},1536)),[[C,"Home"!==e.name&&"Project"!==e.name]]))),128))])),_:1})}}});const R={class:"\n      w-full\n      h-16\n      border-b border-solid border-gray-100\n      flex\n      items-center\n      px-10\n      justify-between\n    "},W=c(" 新建项目 ");var X=e({props:{projectGroupList:{type:Array,required:!0}},emits:["createNewProjectClick"],setup(e,{emit:a}){const l=e,t=()=>{a("createNewProjectClick")};return(e,a)=>{const o=n("n-icon"),s=n("n-button");return i(),p("div",R,[u(Q),u(s,{onClick:t,disabled:0===l.projectGroupList.length},{icon:r((()=>[u(o,null,{default:r((()=>[u(m(S))])),_:1})])),default:r((()=>[W])),_:1},8,["disabled"])])}}});x("data-v-3333af8f");const Y={class:"project-content flex"},Z={class:"\n          flex flex-col\n          items-center\n          w-60\n          bg-gray-100\n          overflow-auto\n          flex-shrink-0\n        "},$=s("div",{class:"mt-4"},"项目组管理",-1),ee=["onClick"],ae=c(" 新建项目组 "),le={class:"\n          flex-auto\n          h-auto\n          p-5\n          flex flex-wrap\n          overflow-auto\n          bg-gray-200\n          pl-10\n          content-start\n        "};P();var te=e({setup(e){const t=a(),d=v(),h=l(!1),y=l(!1),g=l([]),C=l([]),x=l({id:"",name:""}),P=l({id:"",name:""}),q=l({id:"",name:""}),T=l(!1),D=[{label:"重命名",key:"edit"},{label:"删除",key:"delete"}],B=()=>{console.log("?????"),y.value=!1},E=async()=>{try{await A(g.value)}catch(e){t.error("调整顺序失败")}},H=async()=>{B(),P.value.id=L(),C.value.push(P.value),console.log("projectList.value",C.value),await U(x.value.id,C.value),P.value={id:"",name:""},await R()},O=()=>{y.value=!0},F=async()=>{const e={id:L(),name:"新建项目组"+(g.value.length+1)+"("+L().substr(Math.floor(10*Math.random()+1),2)+")"};g.value.push(e),await A(g.value),x.value=e},z=async e=>{try{await(async e=>{const a=await N();if(a.length>0){const l=a.findIndex((a=>e.id===a.id));return l>=0?(a.splice(l,1),A(a),Promise.resolve()):Promise.reject()}return Promise.reject()})(e),t.success("删除成功"),await W()}catch(a){t.error("删除失败")}},Q=async e=>{try{h.value=!1,"edit"===e&&(await(async e=>{const a=await N();if(a.length>0){const l=a.findIndex((a=>e.id===a.id));return l>=0?(a[l]=e,A(a),Promise.resolve()):Promise.reject()}return Promise.reject()})(q.value),t.success("修改成功")),await W()}catch(a){t.error("修改失败")}},R=async()=>{C.value=await G(x.value.id),console.log("current.value.id",x.value.id,C.value)},W=()=>{T.value=!0,setTimeout((async()=>{g.value=await N(),g.value.length>0&&(x.value=g.value[0],await R()),T.value=!1}),1e3)};return b((()=>{W()})),(e,a)=>{const l=n("n-icon"),t=n("n-dropdown"),v=n("n-button"),b=n("n-spin");return i(),o(b,{show:T.value},{default:r((()=>[u(X,{projectGroupList:g.value,onCreateNewProjectClick:O},null,8,["projectGroupList"]),s("div",Y,[s("div",Z,[$,u(m(M),{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),onChange:E},{default:r((()=>[u(_,null,{default:r((()=>[(i(!0),p(j,null,k(g.value,((e,a)=>(i(),p("div",{class:V(["project-aside-item",e.id===x.value.id?"active":""]),key:a,onClick:a=>(e=>{x.value=e,R()})(e)},[c(f(e.name||"新建项目组"+(a+1))+" ",1),u(t,{trigger:"click",onSelect:a=>(async(e,a)=>{q.value=a,"edit"===e&&(h.value=!0),"delete"===e&&d.error({title:"提示",content:"是否删除?",positiveText:"确定",showIcon:!1,negativeText:"取消",onPositiveClick:()=>{z(a)}})})(a,e),options:D,"show-arrow":!0},{default:r((()=>[u(l,{class:"project-aside-item-icon"},{default:r((()=>[u(m(I))])),_:1})])),_:2},1032,["onSelect"])],10,ee)))),128))])),_:1})])),_:1},8,["modelValue"]),u(v,{class:"mt-4 w-56",onClick:F},{icon:r((()=>[u(l,null,{default:r((()=>[u(m(S))])),_:1})])),default:r((()=>[ae])),_:1})]),s("div",le,[(i(!0),p(j,null,k(C.value,((e,a)=>(i(),o(K,{key:a,parentId:x.value.id,id:e.id,name:e.name,onUpdateProjectDetail:R},null,8,["parentId","id","name"])))),128))])]),h.value?(i(),o(J,{key:0,showModal:h.value,inputVal:q.value.name,"onUpdate:inputVal":a[1]||(a[1]=e=>q.value.name=e),placeholder:"请输入新的名字",onCancelClick:a[2]||(a[2]=e=>Q("cancel")),onConfirmClick:a[3]||(a[3]=e=>Q("edit"))},null,8,["showModal","inputVal"])):w("v-if",!0),y.value?(i(),o(J,{key:1,showModal:y.value,inputVal:P.value.name,"onUpdate:inputVal":a[4]||(a[4]=e=>P.value.name=e),placeholder:"请输入项目名字",onCancelClick:B,onConfirmClick:H},null,8,["showModal","inputVal"])):w("v-if",!0)])),_:1},8,["show"])}}});te.__scopeId="data-v-3333af8f";export{te as default};
